

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>morphforge.simulationanalysis.summaries_new &mdash; morphforge</title>
    
    <link rel="stylesheet" href="../../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1-alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/theme_extras.js"></script>
    <link rel="top" title="morphforge" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../../../index.html">
          <span>morphforge</span></a></h1>
        <h2 class="heading"><span>morphforge.simulationanalysis.summaries_new</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a class="uplink" href="../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for morphforge.simulationanalysis.summaries_new</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># ---------------------------------------------------------------------</span>
<span class="c"># Copyright (c) 2012 Michael Hull.</span>
<span class="c"># All rights reserved.</span>
<span class="c">#</span>
<span class="c"># Redistribution and use in source and binary forms, with or without</span>
<span class="c"># modification, are permitted provided that the following conditions</span>
<span class="c"># are met:</span>
<span class="c">#</span>
<span class="c">#  - Redistributions of source code must retain the above copyright</span>
<span class="c">#    notice, this list of conditions and the following disclaimer.</span>
<span class="c">#  - Redistributions in binary form must reproduce the above copyright</span>
<span class="c">#    notice, this list of conditions and the following disclaimer in</span>
<span class="c">#    the documentation and/or other materials provided with the</span>
<span class="c">#    distribution.</span>
<span class="c">#</span>
<span class="c"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="c"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="c"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<span class="c"># A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<span class="c"># HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<span class="c"># SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<span class="c"># LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span class="c"># DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<span class="c"># THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="c"># (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="c">#  OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c"># ----------------------------------------------------------------------</span>

<span class="c">#from morphforge.morphology.core  import MorphPath</span>
<span class="kn">from</span> <span class="nn">morphforge.core</span> <span class="kn">import</span> <span class="n">LocMgr</span>
<span class="kn">from</span> <span class="nn">morphforge.morphology.visitor</span> <span class="kn">import</span> <span class="n">SectionIndexerDF</span>
<span class="c">#from morphforge.simulation.neuron.objects.neuronrecordable import NEURONRecordableOnLocation</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span><span class="p">,</span> <span class="n">choice</span>
<span class="kn">import</span> <span class="nn">pylab</span>




<div class="viewcode-block" id="SummariserOptions"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SummariserOptions">[docs]</a><span class="k">class</span> <span class="nc">SummariserOptions</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<div class="viewcode-block" id="SummariserOptions.__init__"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SummariserOptions.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_overview</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_overview_neuron_to_neuron_diagram</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_overview_individual_neuron_table</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_overview_individual_synapse_table</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_overview_individual_stimuli</span> <span class="o">=</span> <span class="bp">True</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">include_details</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_details_indvidual_neuron</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_details_indvidual_neuron_morphology</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_details_indvidual_neuron_morphology_mpl</span> <span class="o">=</span> <span class="bp">True</span>


</div></div>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">DocumentLayout:</span>


<span class="sd">Root:</span>
<span class="sd">    /Simulation Overview</span>
<span class="sd">        /Overview Diagram</span>
<span class="sd">        /Input Summary</span>
<span class="sd">        /KeyTraces</span>

<span class="sd">    /Details:</span>
<span class="sd">        /Entire Population1</span>

<span class="sd">        /Cells:</span>
<span class="sd">            /Population1</span>
<span class="sd">                /Cell1, Cell2</span>
<span class="sd">            /Population2</span>
<span class="sd">                /Cell1, Cell2</span>
<span class="sd">        /Chemical Synapses:</span>
<span class="sd">            All Details: (By type)</span>
<span class="sd">            By-Presynaptic</span>
<span class="sd">            By-Post Synaptic</span>
<span class="sd">        /Gap Junctions</span>
<span class="sd">            All Details</span>

<span class="sd">        /Stimulations</span>
<span class="sd">            /Current Clamps</span>
<span class="sd">            /Voltage Clamps</span>

<span class="sd">        /Channel Dynamics</span>
<span class="sd">        /Synaptic Dynamics</span>

<span class="sd">    /Platform Information</span>



<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">morphforge.simulation.base</span> <span class="kn">import</span> <span class="n">Simulation</span>

<span class="c"># from morphforge.management import PluginMgr</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">mredoc</span> <span class="kn">as</span> <span class="nn">mrd</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;Unable to import mredoc, you will be unable to produce pdf/html summaries&#39;</span>


<div class="viewcode-block" id="SummariserObject"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SummariserObject">[docs]</a><span class="k">class</span> <span class="nc">SummariserObject</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SummariserObject.build"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SummariserObject.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

</div></div>
<div class="viewcode-block" id="SummariserLibrary"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SummariserLibrary">[docs]</a><span class="k">class</span> <span class="nc">SummariserLibrary</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">summarisers</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SummariserLibrary.register_summariser"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SummariserLibrary.register_summariser">[docs]</a>    <span class="k">def</span> <span class="nf">register_summariser</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">channel_baseclass</span><span class="p">,</span> <span class="n">summariser_class</span><span class="p">):</span>
        <span class="c"># Check it has a to_report_lab Method:</span>
        <span class="c"># Todo: Replace this with &#39;hasattr&#39;</span>
        <span class="c"># assert &#39;to_report_lab&#39; in summariser_class.__dict__</span>

        <span class="c"># Add it to the dictionary of summarisers:</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">summarisers</span><span class="p">[</span><span class="n">channel_baseclass</span><span class="p">]</span> <span class="o">=</span> <span class="n">summariser_class</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SummariserLibrary.get_summarisier"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SummariserLibrary.get_summarisier">[docs]</a>    <span class="k">def</span> <span class="nf">get_summarisier</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">possible_summarisers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ChlType</span><span class="p">,</span> <span class="n">summarisier</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">summarisers</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">),</span> <span class="n">ChlType</span><span class="p">):</span>
                <span class="n">possible_summarisers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summarisier</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">possible_summarisers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">possible_summarisers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">possible_summarisers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;I have to many options for summarising: &#39;</span> \
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="_DotSummaryUtils"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new._DotSummaryUtils">[docs]</a><span class="k">class</span> <span class="nc">_DotSummaryUtils</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="_DotSummaryUtils.save_dot"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new._DotSummaryUtils.save_dot">[docs]</a>    <span class="k">def</span> <span class="nf">save_dot</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">graph</span><span class="p">,</span> <span class="n">format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">morphforge.core</span> <span class="kn">import</span> <span class="n">ObjectLabeller</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">ObjectLabeller</span><span class="o">.</span><span class="n">get_next_unamed_object_name</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">graph</span><span class="p">))</span>
        <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">LocMgr</span><span class="o">.</span><span class="n">get_tmp_path</span><span class="p">()</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/dotout_</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tmp_dir</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">format</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">write_pdf</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fname</span>

</div></div>
<div class="viewcode-block" id="SimulationMRedoc"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc">[docs]</a><span class="k">class</span> <span class="nc">SimulationMRedoc</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SimulationMRedoc.build"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc.build">[docs]</a>    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="n">SummariserOptions</span><span class="p">()</span>

        <span class="n">sim_redoc</span> <span class="o">=</span> <span class="n">SimulationMRedoc</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span><span class="o">.</span><span class="n">mredoc</span>

        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sim_redoc</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Simulation Results:&#39;</span><span class="p">,</span>
                    <span class="n">mrd</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">auto_adjust</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                    <span class="n">sim_redoc</span><span class="p">,</span>
                    <span class="p">)</span>


</div>
<div class="viewcode-block" id="SimulationMRedoc.__init__"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Simulation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mredoc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_simulation</span><span class="p">()</span>

    <span class="c"># Todo:</span></div>
<div class="viewcode-block" id="SimulationMRedoc.build_simulationresult"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc.build_simulationresult">[docs]</a>    <span class="k">def</span> <span class="nf">build_simulationresult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc.build_simulation"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc.build_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">build_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#from morphforge.management import PluginMgr</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s">&#39;Simulation Summary: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">_sim_desc_str</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="n">title</span><span class="p">,</span>
                <span class="n">mrd</span><span class="o">.</span><span class="n">TableOfContents</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">build_simulation_overview</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">build_simulation_details</span><span class="p">(),</span>
                <span class="c">#PluginMgr.summarise_all(),</span>
               <span class="p">)</span>

</div>
<div class="viewcode-block" id="SimulationMRedoc.build_simulation_overview"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc.build_simulation_overview">[docs]</a>    <span class="k">def</span> <span class="nf">build_simulation_overview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">SectionNewPage</span><span class="p">(</span><span class="s">&#39;Simulation Overview&#39;</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">build_population_overview</span><span class="p">(),</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">build_population_complete_dot</span><span class="p">(),</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">build_singlecell_overview</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc.build_simulation_details"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc.build_simulation_details">[docs]</a>    <span class="k">def</span> <span class="nf">build_simulation_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">SectionNewPage</span><span class="p">(</span><span class="s">&quot;Simulation Details&quot;</span><span class="p">,</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">build_singlecell_details</span><span class="p">(),</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">build_population_details</span><span class="p">(),</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">build_details_channels</span><span class="p">(),</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">build_details_synaptic_templates</span><span class="p">(),</span>
               <span class="p">)</span>







    <span class="c"># Overview in terms of populations</span>
    <span class="c"># -------------------------------------</span>

    <span class="c"># The details of the simulation:</span></div>
<div class="viewcode-block" id="SimulationMRedoc.build_population_overview"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc.build_population_overview">[docs]</a>    <span class="k">def</span> <span class="nf">build_population_overview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">neuron_populations</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span>
                <span class="s">&quot;Population | Size | Type &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="p">[(</span><span class="n">pop</span><span class="o">.</span><span class="n">pop_name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="p">),</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">cell_types</span><span class="p">))</span>  <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">neuron_populations</span><span class="p">]</span>
               <span class="p">)</span>
        <span class="n">table2</span> <span class="o">=</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span>
                <span class="s">&quot;Population | Size | Type &quot;&quot;&quot;</span><span class="p">,</span>
                <span class="p">[(</span><span class="n">pop</span><span class="o">.</span><span class="n">synapse_pop_name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="p">),</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pop</span><span class="o">.</span><span class="n">synapse_types</span><span class="p">))</span>  <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">synapse_populations</span><span class="p">]</span>
               <span class="p">)</span>

        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="s">&quot;Population Overview&quot;</span><span class="p">,</span>
                           <span class="n">table</span><span class="p">,</span> <span class="n">table2</span><span class="p">,</span>
                           <span class="c">#self.build_population_overview_dot(),</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">build_population_complete_dot</span><span class="p">()</span>
                          <span class="p">)</span>



</div>
<div class="viewcode-block" id="SimulationMRedoc.build_population_complete_dot"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc.build_population_complete_dot">[docs]</a>    <span class="k">def</span> <span class="nf">build_population_complete_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DOTWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="p">)</span><span class="o">.</span><span class="n">build_population_complete_dot</span><span class="p">()</span>












</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SimulationMRedoc._build_population_cell_table"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._build_population_cell_table">[docs]</a>    <span class="k">def</span> <span class="nf">_build_population_cell_table</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">population</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_build_cell_table</span><span class="p">(</span><span class="n">cell_list</span><span class="o">=</span><span class="n">population</span><span class="p">)</span>
</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SimulationMRedoc._build_cell_table"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._build_cell_table">[docs]</a>    <span class="k">def</span> <span class="nf">_build_cell_table</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">cell_list</span><span class="p">):</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span><span class="s">&#39;Name|Type|SA(um2)|\#sections/segments|Regions(SA(um2):nseg)|\#Pre/Post-Synapse|\#GapJunctions|Chls&#39;</span><span class="p">,</span>
                <span class="p">[(</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                  <span class="n">cell</span><span class="o">.</span><span class="n">cell_type_str</span><span class="p">,</span>
                  <span class="s">&quot;</span><span class="si">%.0f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">surface_area</span><span class="p">),</span>
                  <span class="s">&quot;</span><span class="si">%d</span><span class="s">:</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="p">),</span> <span class="n">cell</span><span class="o">.</span><span class="n">segmenter</span><span class="o">.</span><span class="n">get_num_segment_total</span><span class="p">(</span><span class="n">cell</span><span class="p">)),</span>
                  <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">(</span><span class="si">%d</span><span class="s">:</span><span class="si">%d</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rgn</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">rgn</span><span class="o">.</span><span class="n">surface_area</span><span class="p">,</span> <span class="n">cell</span><span class="o">.</span><span class="n">segmenter</span><span class="o">.</span><span class="n">get_num_segment_region</span><span class="p">(</span><span class="n">rgn</span><span class="p">))</span> <span class="k">for</span> <span class="n">rgn</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">regions</span><span class="p">]),</span>
                  <span class="s">&quot;</span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">presynaptic_connections</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">postsynaptic_connections</span><span class="p">)),</span>
                  <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">electrical_connections</span><span class="p">),</span>
                  <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">chl</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">chl</span> <span class="ow">in</span> <span class="n">cell</span><span class="o">.</span><span class="n">biophysics</span><span class="o">.</span><span class="n">get_all_channels_applied_to_cell</span><span class="p">()]),</span>
                 <span class="p">)</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cell_list</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">table</span>

</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SimulationMRedoc._build_synapse_table"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._build_synapse_table">[docs]</a>    <span class="k">def</span> <span class="nf">_build_synapse_table</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">synapses_list</span><span class="p">):</span>

        <span class="c">#for syn in synapses_list:</span>
        <span class="c">#    print syn.name</span>
        <span class="c">#    print syn.get_trigger().get_summary_string()</span>
        <span class="c">#    print syn.get_postsynaptic_mechanism().cell_location.get_location_description_str()</span>
        <span class="c">#    print syn.get_postsynaptic_mechanism()</span>
        <span class="c">#    print syn.__dict__</span>
        <span class="c">##assert False</span>

        <span class="n">table</span> <span class="o">=</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span><span class="s">&#39;Name|Type|Trigger| PostSynaptic Cell|Receptor&#39;</span><span class="p">,</span>
                <span class="p">[(</span><span class="n">syn</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                  <span class="s">&#39;&lt;?&gt;&#39;</span><span class="p">,</span> <span class="c">#syn.syn_type_str,</span>
                  <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span> <span class="n">syn</span><span class="o">.</span><span class="n">get_trigger</span><span class="p">()</span><span class="o">.</span><span class="n">get_summary_string</span><span class="p">()</span> <span class="p">),</span>
                  <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">syn</span><span class="o">.</span><span class="n">get_postsynaptic_mechanism</span><span class="p">()</span><span class="o">.</span><span class="n">cell_location</span><span class="o">.</span><span class="n">get_location_description_str</span><span class="p">()</span> <span class="p">),</span>
                  <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">syn</span><span class="o">.</span><span class="n">get_postsynaptic_mechanism</span><span class="p">()</span><span class="o">.</span><span class="n">get_summary_description</span><span class="p">()</span> <span class="p">),</span>

                  <span class="c">#&#39;None&#39;,</span>
                 <span class="p">)</span> <span class="k">for</span> <span class="n">syn</span> <span class="ow">in</span> <span class="n">synapses_list</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">table</span>


</div>
<div class="viewcode-block" id="SimulationMRedoc.build_population_details"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc.build_population_details">[docs]</a>    <span class="k">def</span> <span class="nf">build_population_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Population Details:&#39;</span><span class="p">,</span>
                <span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_population_details</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span> <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">neuron_populations</span><span class="p">]</span>
       <span class="p">)</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc._build_population_details"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._build_population_details">[docs]</a>    <span class="k">def</span> <span class="nf">_build_population_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pop</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Population: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">pop</span><span class="o">.</span><span class="n">pop_name</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build_population_cell_table</span><span class="p">(</span><span class="n">pop</span><span class="p">),</span>
                <span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">build_neuron_details</span><span class="p">(</span><span class="n">nrn</span><span class="p">)</span> <span class="k">for</span> <span class="n">nrn</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">]</span>
       <span class="p">)</span>

    <span class="c"># --------------------------------------------------------</span>

    <span class="c"># Single Cell Overview:</span>
    <span class="c"># --------------------------------------------------------</span>
    <span class="c"># The details of the simulation:</span></div>
<div class="viewcode-block" id="SimulationMRedoc.build_singlecell_overview"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc.build_singlecell_overview">[docs]</a>    <span class="k">def</span> <span class="nf">build_singlecell_overview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">are_all_cells_in_pops</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">HierachyScope</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build_singlecell_overview_cells</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build_singlecell_overview_synapses</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build_singlecell_overview_iclamps</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_build_singlecell_overview_vclamps</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc._build_singlecell_overview_cells"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._build_singlecell_overview_cells">[docs]</a>    <span class="k">def</span> <span class="nf">_build_singlecell_overview_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Individual Cells&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_build_cell_table</span><span class="p">(</span><span class="n">cell_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">cells</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc._build_singlecell_overview_synapses"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._build_singlecell_overview_synapses">[docs]</a>    <span class="k">def</span> <span class="nf">_build_singlecell_overview_synapses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Individual Synapses&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_build_synapse_table</span><span class="p">(</span><span class="n">synapses_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">synapses</span><span class="p">)</span>
                           <span class="p">)</span>

    <span class="c"># Stim Tables:</span></div>
<div class="viewcode-block" id="SimulationMRedoc._build_singlecell_overview_stimtable"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._build_singlecell_overview_stimtable">[docs]</a>    <span class="k">def</span> <span class="nf">_build_singlecell_overview_stimtable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stims</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">stim</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                 <span class="n">stim</span><span class="o">.</span><span class="n">location_summary_str</span><span class="p">,</span>
                 <span class="n">stim</span><span class="o">.</span><span class="n">get_summary_description</span><span class="p">(),</span>
                 <span class="p">)</span> <span class="k">for</span> <span class="n">stim</span> <span class="ow">in</span> <span class="n">stims</span><span class="p">]</span>
        <span class="n">tbl</span> <span class="o">=</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span><span class="s">&#39;Name|Location|Description&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tbl</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc._build_singlecell_overview_iclamps"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._build_singlecell_overview_iclamps">[docs]</a>    <span class="k">def</span> <span class="nf">_build_singlecell_overview_iclamps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Current Clamps&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_build_singlecell_overview_stimtable</span><span class="p">(</span><span class="n">stims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">current_clamps</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc._build_singlecell_overview_vclamps"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._build_singlecell_overview_vclamps">[docs]</a>    <span class="k">def</span> <span class="nf">_build_singlecell_overview_vclamps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Voltage Clamps&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_build_singlecell_overview_stimtable</span><span class="p">(</span><span class="n">stims</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">voltage_clamps</span><span class="p">))</span>







</div>
<div class="viewcode-block" id="SimulationMRedoc.build_singlecell_details"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc.build_singlecell_details">[docs]</a>    <span class="k">def</span> <span class="nf">build_singlecell_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sub_sections</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">build_neuron_details</span><span class="p">(</span><span class="n">nrn</span><span class="p">)</span> <span class="k">for</span> <span class="n">nrn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">cells</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Single Cell Details&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">sub_sections</span><span class="p">)</span>

</div>
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="SimulationMRedoc._build_details_channel"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._build_details_channel">[docs]</a>    <span class="k">def</span> <span class="nf">_build_details_channel</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">chl</span><span class="p">):</span>

        <span class="n">sumcls</span> <span class="o">=</span> <span class="n">SummariserLibrary</span><span class="o">.</span><span class="n">get_summarisier</span><span class="p">(</span><span class="n">chl</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sumcls</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Summary of channel: </span><span class="si">%s</span><span class="s"> &lt;!! Summariser Missing !!&gt;&#39;</span> <span class="o">%</span> <span class="n">chl</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">mrd</span><span class="o">.</span><span class="n">Paragraph</span><span class="p">(</span><span class="s">&#39;&lt;Summariser Missing for type: </span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">chl</span><span class="p">))</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">sumcls</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">chl</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc.build_details_channels"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc.build_details_channels">[docs]</a>    <span class="k">def</span> <span class="nf">build_details_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">channels</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">get_all_channels</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">SectionNewPage</span><span class="p">(</span><span class="s">&#39;Channels Details&#39;</span><span class="p">,</span>
                <span class="o">*</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_details_channel</span><span class="p">(</span><span class="n">chl</span><span class="p">)</span> <span class="k">for</span> <span class="n">chl</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">]</span>
                <span class="p">)</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc._build_details_synaptic_templ"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._build_details_synaptic_templ">[docs]</a>    <span class="k">def</span> <span class="nf">_build_details_synaptic_templ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">syn_tmpl</span><span class="p">):</span>
        <span class="c">#return &#39;Blah: %s&#39; % syn.name</span>
        <span class="n">sumcls</span> <span class="o">=</span> <span class="n">SummariserLibrary</span><span class="o">.</span><span class="n">get_summarisier</span><span class="p">(</span><span class="n">syn_tmpl</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sumcls</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Summary of synaptic-template: </span><span class="si">%s</span><span class="s"> &lt;!! Summariser Missing !!&gt;&#39;</span> <span class="o">%</span> <span class="n">syn_tmpl</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">mrd</span><span class="o">.</span><span class="n">Paragraph</span><span class="p">(</span><span class="s">&#39;&lt;Summariser Missing for type: </span><span class="si">%s</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">syn_tmpl</span><span class="p">))</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">sumcls</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">syn_tmpl</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc.build_details_synaptic_templates"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc.build_details_synaptic_templates">[docs]</a>    <span class="k">def</span> <span class="nf">build_details_synaptic_templates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">synaptic_templates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">postsynaptic_templates</span>

        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">SectionNewPage</span><span class="p">(</span><span class="s">&#39;Synaptic Template Details&#39;</span><span class="p">,</span>
                <span class="o">*</span><span class="p">(</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_details_synaptic_templ</span><span class="p">(</span><span class="n">syntemplate</span><span class="p">)</span> <span class="k">for</span> <span class="n">syntemplate</span> <span class="ow">in</span> <span class="n">synaptic_templates</span><span class="p">]</span>  <span class="p">)</span>
                <span class="p">)</span>



    <span class="c"># Individual Neuron details:</span>
    <span class="c"># -------------------------------</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc._create_neuron_details_1_morphology"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._create_neuron_details_1_morphology">[docs]</a>    <span class="k">def</span> <span class="nf">_create_neuron_details_1_morphology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nrn</span><span class="p">):</span>
        <span class="n">morph</span> <span class="o">=</span> <span class="n">nrn</span><span class="o">.</span><span class="n">morphology</span>
        <span class="n">section_indexer</span> <span class="o">=</span> <span class="n">SectionIndexerDF</span><span class="p">(</span><span class="n">morph</span><span class="p">)</span>
        <span class="n">section_table</span> <span class="o">=</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span>
                <span class="s">&#39;ID|Tags|Lateral Surface Area (um2)|Region|nseg|L|diam (prox/dist)&#39;</span><span class="p">,</span>
                <span class="p">[(</span>  <span class="n">section_indexer</span><span class="p">[</span><span class="n">sec</span><span class="p">],</span>
                    <span class="n">sec</span><span class="o">.</span><span class="n">idtag</span><span class="p">,</span>
                    <span class="s">&#39;</span><span class="si">%.0f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">sec</span><span class="o">.</span><span class="n">area</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">sec</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">sec</span><span class="o">.</span><span class="n">region</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
                    <span class="n">nrn</span><span class="o">.</span><span class="n">cell_segmenter</span><span class="o">.</span><span class="n">get_num_segments</span><span class="p">(</span><span class="n">sec</span><span class="p">),</span>
                    <span class="n">sec</span><span class="o">.</span><span class="n">length</span><span class="p">,</span>
                    <span class="s">&#39;</span><span class="si">%.1f</span><span class="s">/</span><span class="si">%.1f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sec</span><span class="o">.</span><span class="n">p_r</span> <span class="o">*</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">sec</span><span class="o">.</span><span class="n">d_r</span> <span class="o">*</span> <span class="mf">2.</span><span class="p">)</span>
                    <span class="p">)</span> <span class="k">for</span> <span class="n">sec</span> <span class="ow">in</span> <span class="n">morph</span><span class="p">],</span>
                <span class="n">caption</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">:Morphology (Sections)&#39;</span> <span class="o">%</span> <span class="n">nrn</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">region_table</span> <span class="o">=</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span>
                <span class="s">&#39;Region|Surface Area|\#Sections&#39;</span><span class="p">,</span>
                <span class="p">[(</span><span class="n">rgn</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">rgn</span><span class="o">.</span><span class="n">surface_area</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgn</span><span class="p">))</span> <span class="k">for</span> <span class="n">rgn</span> <span class="ow">in</span> <span class="n">nrn</span><span class="o">.</span><span class="n">morphology</span><span class="o">.</span><span class="n">regions</span><span class="p">],</span>
                <span class="n">caption</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">:Morphology (Regions)&#39;</span> <span class="o">%</span> <span class="n">nrn</span><span class="o">.</span><span class="n">name</span>
                <span class="p">)</span>


        <span class="n">child_sections</span> <span class="o">=</span> <span class="p">[</span><span class="n">section_table</span><span class="p">,</span> <span class="n">region_table</span><span class="p">]</span>

        <span class="c"># Include a picture with matplotlib?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">include_details_indvidual_neuron_morphology_mpl</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">morphforge.morphology.ui</span> <span class="kn">import</span> <span class="n">MatPlotLibViewer</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">MatPlotLibViewer</span><span class="p">(</span><span class="n">nrn</span><span class="o">.</span><span class="n">morphology</span><span class="p">,</span> <span class="n">fig_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">)})</span><span class="o">.</span><span class="n">fig</span>
            <span class="n">child_sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span> <span class="p">)</span>


        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">HierachyScope</span><span class="p">(</span><span class="o">*</span><span class="n">child_sections</span><span class="p">)</span> <span class="c">#section_table, region_table, mrd.Image(fig), )</span>



</div>
<div class="viewcode-block" id="SimulationMRedoc._create_neuron_details_2b_pta"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._create_neuron_details_2b_pta">[docs]</a>    <span class="k">def</span> <span class="nf">_create_neuron_details_2b_pta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nrn</span><span class="p">):</span>
        <span class="n">passives</span> <span class="o">=</span> <span class="n">nrn</span><span class="o">.</span><span class="n">biophysics</span><span class="o">.</span><span class="n">get_applied_passives</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span>
                <span class="s">&#39;PassiveProp|Priority|Targetter|Value&#39;</span><span class="p">,</span>
                <span class="p">[</span>  <span class="p">(</span><span class="n">pta</span><span class="o">.</span><span class="n">passiveproperty</span><span class="p">,</span>
                    <span class="n">pta</span><span class="o">.</span><span class="n">targetter</span><span class="o">.</span><span class="n">get_priority</span><span class="p">(),</span>
                    <span class="n">pta</span><span class="o">.</span><span class="n">targetter</span><span class="o">.</span><span class="n">get_description</span><span class="p">(),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">pta</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
                    <span class="p">)</span> <span class="k">for</span> <span class="n">pta</span> <span class="ow">in</span> <span class="n">passives</span><span class="p">],</span>
                <span class="n">caption</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">:Passive Properties&#39;</span> <span class="o">%</span> <span class="n">nrn</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="SimulationMRedoc._create_neuron_details_2_mta"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._create_neuron_details_2_mta">[docs]</a>    <span class="k">def</span> <span class="nf">_create_neuron_details_2_mta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nrn</span><span class="p">):</span>
        <span class="n">channels</span> <span class="o">=</span> <span class="n">nrn</span><span class="o">.</span><span class="n">biophysics</span><span class="o">.</span><span class="n">get_applied_mtas</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span>
                <span class="s">&#39;Mechanism|Priority|Targetter|Applicator&#39;</span><span class="p">,</span>
                <span class="p">[</span> <span class="p">(</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mta</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">),</span>
                    <span class="n">mta</span><span class="o">.</span><span class="n">targetter</span><span class="o">.</span><span class="n">get_priority</span><span class="p">(),</span>
                    <span class="n">mta</span><span class="o">.</span><span class="n">targetter</span><span class="o">.</span><span class="n">get_description</span><span class="p">(),</span>
                    <span class="n">mta</span><span class="o">.</span><span class="n">applicator</span><span class="o">.</span><span class="n">get_description</span><span class="p">(),</span>
                    <span class="p">)</span> <span class="k">for</span> <span class="n">mta</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">],</span>
                <span class="n">caption</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">:Channels&#39;</span> <span class="o">%</span> <span class="n">nrn</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc._create_neuron_details_3a_presynapses"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._create_neuron_details_3a_presynapses">[docs]</a>    <span class="k">def</span> <span class="nf">_create_neuron_details_3a_presynapses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nrn</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span><span class="s">&#39;Type|Distance From Soma&#39;</span><span class="p">,</span> <span class="p">[],</span>
                                    <span class="n">caption</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">:Presynaptic Connections&#39;</span>
                                     <span class="o">%</span> <span class="n">nrn</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc._create_neuron_details_3b_postsynapses"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._create_neuron_details_3b_postsynapses">[docs]</a>    <span class="k">def</span> <span class="nf">_create_neuron_details_3b_postsynapses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nrn</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span><span class="s">&#39;Type|Distance From Soma&#39;</span><span class="p">,</span> <span class="p">[],</span>
                                    <span class="n">caption</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">:Postsynaptic Connections&#39;</span>
                                     <span class="o">%</span> <span class="n">nrn</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc._create_neuron_details_3c_gapjunctions"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._create_neuron_details_3c_gapjunctions">[docs]</a>    <span class="k">def</span> <span class="nf">_create_neuron_details_3c_gapjunctions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nrn</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span><span class="s">&#39;Type|Distance From Soma&#39;</span><span class="p">,</span> <span class="p">[],</span>
                                    <span class="n">caption</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">:Gap Junctions&#39;</span>
                                    <span class="o">%</span> <span class="n">nrn</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc._create_neuron_details_4_stimulation"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc._create_neuron_details_4_stimulation">[docs]</a>    <span class="k">def</span> <span class="nf">_create_neuron_details_4_stimulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nrn</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span><span class="s">&#39;Type|Distance From Soma&#39;</span><span class="p">,</span> <span class="p">[],</span>
                                    <span class="n">caption</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">:Stimulation&#39;</span> <span class="o">%</span> <span class="n">nrn</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SimulationMRedoc.build_neuron_details"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.SimulationMRedoc.build_neuron_details">[docs]</a>    <span class="k">def</span> <span class="nf">build_neuron_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">neuron</span><span class="p">):</span>

        <span class="c">#return mrd.SectionNewPage(</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span>
            <span class="s">&#39;Neuron:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">neuron</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_neuron_details_1_morphology</span><span class="p">(</span><span class="n">neuron</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_neuron_details_2b_pta</span><span class="p">(</span><span class="n">neuron</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_neuron_details_2_mta</span><span class="p">(</span><span class="n">neuron</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_neuron_details_3a_presynapses</span><span class="p">(</span><span class="n">neuron</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_neuron_details_3b_postsynapses</span><span class="p">(</span><span class="n">neuron</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_neuron_details_3c_gapjunctions</span><span class="p">(</span><span class="n">neuron</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_neuron_details_4_stimulation</span><span class="p">(</span><span class="n">neuron</span><span class="p">),</span>
            <span class="p">)</span>


    <span class="c"># -------------------------------</span>



</div></div>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MaxNLocator</span>




<div class="viewcode-block" id="build_connectivity_graph"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.build_connectivity_graph">[docs]</a><span class="k">def</span> <span class="nf">build_connectivity_graph</span><span class="p">(</span><span class="n">synapse_pop</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.75</span><span class="p">):</span>

    <span class="n">prepop</span> <span class="o">=</span> <span class="n">synapse_pop</span><span class="o">.</span><span class="n">presynaptic_population</span>
    <span class="c">#if prepop:</span>
    <span class="c">#    prepop_lut = prepop.build_cell_to_index_lut()</span>

    <span class="n">postpop</span> <span class="o">=</span> <span class="n">synapse_pop</span><span class="o">.</span><span class="n">postsynaptic_population</span>
    <span class="c">#postpop_lut = postpop.build_cell_to_index_lut()</span>

    <span class="n">connectivity</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">syn</span> <span class="ow">in</span> <span class="n">synapse_pop</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">prepop</span><span class="p">:</span>
            <span class="n">pre_index</span> <span class="o">=</span> <span class="n">syn</span><span class="o">.</span><span class="n">get_presynaptic_cell</span><span class="p">()</span><span class="o">.</span><span class="n">index_in_pop</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pre_index</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">post_index</span> <span class="o">=</span> <span class="n">syn</span><span class="o">.</span><span class="n">get_postsynaptic_cell</span><span class="p">()</span><span class="o">.</span><span class="n">index_in_pop</span>
        <span class="n">connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pre_index</span><span class="p">,</span> <span class="n">post_index</span><span class="p">))</span>

    <span class="n">prepop_len</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prepop</span><span class="p">)</span> <span class="k">if</span> <span class="n">prepop</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">postpop_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">postpop</span><span class="p">)</span>
    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="p">(</span><span class="n">prepop_len</span><span class="p">,</span> <span class="n">postpop_len</span><span class="p">)</span> <span class="p">)</span>

    <span class="kn">import</span> <span class="nn">pylab</span>
    <span class="n">figsize_raw</span> <span class="o">=</span><span class="p">(</span><span class="n">size</span> <span class="o">*</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">prepop_len</span><span class="p">)</span><span class="o">/</span><span class="n">max_len</span><span class="p">),</span> <span class="n">size</span><span class="o">*</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">postpop_len</span><span class="p">)</span><span class="o">/</span><span class="n">max_len</span><span class="p">))</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize_raw</span> <span class="c">#figsize_raw[0]+0.75, figsize_raw[1]+0.75</span>
    <span class="k">print</span> <span class="n">figsize</span>



    <span class="n">fig</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">400</span> <span class="p">)</span>
    <span class="c">#ax = fig.add_subplot(1, 1, 1, aspect=&#39;equal&#39;)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">connectivity</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span>
    <span class="c">#ax.axis(&#39;equal&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">prepop_len</span><span class="o">-</span><span class="mf">0.5</span> <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">postpop_len</span><span class="o">-</span><span class="mf">0.5</span> <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">prepop_len</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">postpop_len</span><span class="p">,</span> <span class="mi">3</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
    <span class="c">#pylab.suptitle(&#39;Connectivity: %d synapses&#39;%len(synapse_pop))</span>
    <span class="c">#pylab.show()</span>
    <span class="k">return</span> <span class="n">fig</span>










</div>
<div class="viewcode-block" id="DOTWriter"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.DOTWriter">[docs]</a><span class="k">class</span> <span class="nc">DOTWriter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<div class="viewcode-block" id="DOTWriter.__init__"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.DOTWriter.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sim</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span> <span class="o">=</span> <span class="n">sim</span>
</div>
<div class="viewcode-block" id="DOTWriter.build_population_complete_dot"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforge.simulationanalysis.summaries_new.html#morphforge.simulationanalysis.summaries_new.DOTWriter.build_population_complete_dot">[docs]</a>    <span class="k">def</span> <span class="nf">build_population_complete_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fig_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fig_out</span> <span class="o">=</span> <span class="s">&#39;/tmp/dotimages/&#39;</span>
        <span class="kn">import</span> <span class="nn">pydot</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Dot</span><span class="p">(</span><span class="s">&#39;graphname&#39;</span><span class="p">,</span> <span class="n">graph_type</span><span class="o">=</span><span class="s">&#39;digraph&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s">&#39;7,7&#39;</span> <span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="s">&#39;compress&#39;</span><span class="p">,</span> <span class="n">compound</span><span class="o">=</span><span class="s">&#39;true&#39;</span><span class="p">,</span> <span class="n">splines</span><span class="o">=</span><span class="s">&#39;true&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&#39;0.3&#39;</span> <span class="p">)</span>

        <span class="n">size</span> <span class="o">=</span> <span class="s">&#39;0.55&#39;</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="s">&#39;6&#39;</span>
        <span class="n">kwargs_general</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;fontsize&#39;</span><span class="p">:</span> <span class="n">fontsize</span><span class="p">,</span>
            <span class="s">&#39;fixedsize&#39;</span><span class="p">:</span> <span class="s">&#39;True&#39;</span><span class="p">,</span>
            <span class="s">&#39;width&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
            <span class="s">&#39;height&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
            <span class="s">&#39;fontname&#39;</span><span class="p">:</span><span class="s">&#39;Helvetica&#39;</span>
            <span class="p">}</span>


        <span class="n">cell_size</span><span class="o">=</span><span class="s">&#39;0.25&#39;</span>
        <span class="n">kwargs_cell</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;shape&#39;</span><span class="p">:</span><span class="s">&#39;circle&#39;</span><span class="p">,</span> <span class="s">&#39;fillcolor&#39;</span><span class="p">:</span><span class="s">&#39;#80b3ffff&#39;</span><span class="p">,</span> <span class="s">&#39;color&#39;</span><span class="p">:</span><span class="s">&#39;#0066ffff&#39;</span><span class="p">,</span> <span class="s">&#39;style&#39;</span><span class="p">:</span><span class="s">&#39;filled&#39;</span><span class="p">,</span> <span class="s">&#39;penwidth&#39;</span><span class="p">:</span><span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;width&#39;</span><span class="p">:</span><span class="n">cell_size</span><span class="p">,</span> <span class="s">&#39;height&#39;</span><span class="p">:</span><span class="n">cell_size</span> <span class="p">}</span>
        <span class="n">kwargs_cc</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;shape&#39;</span><span class="p">:</span><span class="s">&#39;circle&#39;</span><span class="p">,</span> <span class="s">&#39;style&#39;</span><span class="p">:</span><span class="s">&#39;filled&#39;</span><span class="p">,</span> <span class="s">&#39;width&#39;</span><span class="p">:</span><span class="s">&#39;0.05&#39;</span><span class="p">,</span> <span class="p">}</span>


        <span class="n">kwargs_pop</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;style&#39;</span><span class="p">:</span><span class="s">&#39;filled&#39;</span><span class="p">,</span> <span class="s">&#39;color&#39;</span><span class="p">:</span><span class="s">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="s">&#39;nodesep&#39;</span><span class="p">:</span><span class="s">&#39;100&#39;</span> <span class="p">}</span>
        <span class="n">kwargs_synpop</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;shape&#39;</span><span class="p">:</span><span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="s">&#39;fixedsize&#39;</span><span class="p">:</span><span class="s">&#39;false&#39;</span>  <span class="p">}</span>
        <span class="n">kwargs_synpop_img</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;shape&#39;</span><span class="p">:</span><span class="s">&#39;square&#39;</span><span class="p">,</span> <span class="s">&#39;labelloc&#39;</span><span class="p">:</span><span class="s">&#39;b&#39;</span><span class="p">,</span>   <span class="s">&#39;scale&#39;</span><span class="p">:</span><span class="s">&#39;false&#39;</span><span class="p">,</span> <span class="s">&#39;fixedsize&#39;</span><span class="p">:</span> <span class="s">&#39;true&#39;</span><span class="p">}</span>
        <span class="n">kwargs_synpop_edge</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;penwidth&#39;</span><span class="p">:</span><span class="s">&#39;3&#39;</span><span class="p">,</span> <span class="s">&#39;color&#39;</span><span class="p">:</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="s">&#39;minlen&#39;</span><span class="p">:</span><span class="s">&#39;50&#39;</span> <span class="p">}</span>

        <span class="n">kwargs_syn</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;color&#39;</span><span class="p">:</span><span class="s">&#39;darkgreen&#39;</span><span class="p">,</span>  <span class="s">&#39;penwidth&#39;</span><span class="p">:</span><span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="s">&#39;arrowhead&#39;</span><span class="p">:</span><span class="s">&#39;&quot;tee&quot;&#39;</span> <span class="p">}</span>

        <span class="c"># Map Simulation objects into dot objects:</span>
        <span class="n">obj2nodedict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">subgraphs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Populations become subgraphs:</span>
        <span class="k">for</span> <span class="n">population</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">neuron_populations</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Cluster</span><span class="p">(</span><span class="n">population</span><span class="o">.</span><span class="n">pop_name</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">population</span><span class="o">.</span><span class="n">pop_name</span><span class="p">,</span> <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">kwargs_general</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span>  <span class="n">kwargs_pop</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">))</span>
            <span class="n">subgraphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">obj2nodedict</span><span class="p">[</span><span class="n">population</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>


        <span class="c"># Cells into Nodes</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">cells</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
                <span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">cell</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">population</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&#39;&lt;</span><span class="si">%d</span><span class="s">&gt;&#39;</span> <span class="o">%</span> <span class="n">cell</span><span class="o">.</span><span class="n">index_in_pop</span><span class="p">,</span>
                <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">kwargs_general</span><span class="o">.</span><span class="n">items</span><span class="p">()</span><span class="o">+</span> <span class="n">kwargs_cell</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="p">)</span>
            <span class="n">obj2nodedict</span><span class="p">[</span><span class="n">cell</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>

            <span class="k">if</span> <span class="n">cell</span><span class="o">.</span><span class="n">population</span><span class="p">:</span>
                <span class="n">obj2nodedict</span><span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">population</span><span class="p">]</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>



        <span class="k">for</span> <span class="n">sg</span> <span class="ow">in</span> <span class="n">subgraphs</span><span class="p">:</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add_subgraph</span><span class="p">(</span><span class="n">sg</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">subgraphs</span>



        <span class="c"># Synapse Populations are turned into a node, with edges from pre and</span>
        <span class="c"># to the post synaptic population:</span>
        <span class="k">for</span> <span class="n">synpopindex</span><span class="p">,</span> <span class="n">synpop</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">synapse_populations</span><span class="p">):</span>

            <span class="n">synpopcluster</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Cluster</span><span class="p">(</span><span class="s">&#39;SynpopCluster&#39;</span><span class="o">+</span><span class="n">synpop</span><span class="o">.</span><span class="n">synapse_pop_name</span><span class="p">)</span>

            <span class="c"># Create the connectivity graph:</span>
            <span class="n">connectivity_graph_figure</span> <span class="o">=</span> <span class="n">build_connectivity_graph</span><span class="p">(</span><span class="n">synpop</span><span class="p">)</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">fig_out</span> <span class="o">+</span> <span class="s">&#39;/synpop</span><span class="si">%d</span><span class="s">.png&#39;</span> <span class="o">%</span> <span class="n">synpopindex</span>
            <span class="n">pylab</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">bb_inches</span><span class="o">=</span><span class="s">&#39;tight&#39;</span><span class="p">)</span>


            <span class="n">n</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">synpop</span><span class="o">.</span><span class="n">synapse_pop_name</span><span class="o">+</span><span class="s">&#39;im&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">kwargs_general</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">kwargs_synpop_img</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
            <span class="n">synpopcluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>


            <span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="n">label</span><span class="o">+=</span> <span class="n">synpop</span><span class="o">.</span><span class="n">synapse_pop_name</span>
            <span class="n">len_prepop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">synpop</span><span class="o">.</span><span class="n">presynaptic_population</span><span class="p">)</span> <span class="k">if</span> <span class="n">synpop</span><span class="o">.</span><span class="n">presynaptic_population</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="n">pc_conn</span> <span class="o">=</span> <span class="mf">100.</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">synpop</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">len_prepop</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">synpop</span><span class="o">.</span><span class="n">postsynaptic_population</span><span class="p">))</span>
            <span class="c">#print pc_conn</span>
            <span class="c">#pc_conn=50.</span>
            <span class="c">#label+= &#39;\\nType: %s&#39;% (synpop.type)</span>
            <span class="n">label</span><span class="o">+=</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">nSynapses: </span><span class="si">%d</span><span class="s"> (</span><span class="si">%d%%</span><span class="s">)&#39;</span><span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">synpop</span><span class="p">),</span> <span class="n">pc_conn</span> <span class="p">)</span>
            <span class="c">#label= synpop.synapse_pop_name</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">synpop</span><span class="o">.</span><span class="n">synapse_pop_name</span><span class="o">+</span><span class="s">&#39;cap&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;&quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span><span class="o">%</span><span class="n">label</span><span class="p">,</span>  <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">kwargs_general</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">kwargs_synpop</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
            <span class="n">synpopcluster</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>


            <span class="n">obj2nodedict</span><span class="p">[</span><span class="n">synpop</span><span class="p">]</span> <span class="o">=</span> <span class="n">synpopcluster</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add_subgraph</span><span class="p">(</span><span class="n">synpopcluster</span><span class="p">)</span>

            <span class="c"># Connect to pre- and post- synaptic pops:</span>
            <span class="n">post_pop</span> <span class="o">=</span> <span class="n">synpop</span><span class="o">.</span><span class="n">postsynaptic_population</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">synpopcluster</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">obj2nodedict</span><span class="p">[</span><span class="n">post_pop</span><span class="p">]</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">kwargs_general</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">kwargs_synpop_edge</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">))</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

            <span class="n">pre_pop</span> <span class="o">=</span> <span class="n">synpop</span><span class="o">.</span><span class="n">presynaptic_population</span>
            <span class="k">if</span> <span class="n">pre_pop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">e</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span> <span class="n">obj2nodedict</span><span class="p">[</span><span class="n">pre_pop</span><span class="p">]</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="n">synpopcluster</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">kwargs_general</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">kwargs_synpop_edge</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">))</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;NONE&#39;</span>





        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">synapse</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">synapses</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">synapse</span><span class="o">.</span><span class="n">population</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">pre_cell</span> <span class="o">=</span> <span class="n">synapse</span><span class="o">.</span><span class="n">get_presynaptic_cell</span><span class="p">()</span>
            <span class="n">post_cell</span> <span class="o">=</span> <span class="n">synapse</span><span class="o">.</span><span class="n">get_postsynaptic_cell</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">pre_cell</span><span class="p">:</span>
                <span class="n">pre_n</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;SpikeTimes</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span>
                                   <span class="n">shape</span><span class="o">=</span><span class="s">&#39;point&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;lightsalmon&#39;</span><span class="p">,</span>
                                   <span class="n">style</span><span class="o">=</span><span class="s">&#39;filled&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs_general</span><span class="p">)</span>
                <span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">pre_n</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pre_n</span> <span class="o">=</span> <span class="n">obj2nodedict</span><span class="p">[</span><span class="n">pre_cell</span><span class="p">]</span>
            <span class="n">post_n</span> <span class="o">=</span> <span class="n">obj2nodedict</span><span class="p">[</span><span class="n">post_cell</span><span class="p">]</span>

            <span class="n">syn_name</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">synapse</span><span class="o">.</span><span class="n">name</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">pre_n</span><span class="p">,</span> <span class="n">post_n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">syn_name</span><span class="p">,</span>
                           <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">kwargs_general</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="o">+</span> <span class="n">kwargs_syn</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>





        <span class="n">stims</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c"># Simulations:</span>
        <span class="k">for</span> <span class="n">cclamp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">current_clamps</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;&quot;IClamp: </span><span class="si">%s</span><span class="se">\\</span><span class="s">n </span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cclamp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">cclamp</span><span class="o">.</span><span class="n">location_summary_dot_str</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span>
                <span class="n">cclamp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
                <span class="o">**</span><span class="nb">dict</span><span class="p">(</span><span class="n">kwargs_general</span><span class="o">.</span><span class="n">items</span><span class="p">()</span><span class="o">+</span> <span class="n">kwargs_cc</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="p">)</span>
            <span class="n">stims</span><span class="p">[</span><span class="n">cclamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

            <span class="c"># Make the edge:</span>
            <span class="n">cell_node</span> <span class="o">=</span> <span class="n">obj2nodedict</span><span class="p">[</span><span class="n">cclamp</span><span class="o">.</span><span class="n">cell</span><span class="p">]</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">pydot</span><span class="o">.</span><span class="n">Edge</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">cell_node</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">arrowhead</span><span class="o">=</span><span class="s">&#39;vee&#39;</span><span class="p">,</span> <span class="n">arrowsize</span><span class="o">=</span><span class="s">&#39;0.75&#39;</span><span class="p">)</span>  <span class="c"># **kwargs)</span>
            <span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="c">## Records:</span>
        <span class="c">#records = {}</span>
        <span class="c">#for record in self.sim.recordables:</span>
        <span class="c">#    name = record.name</span>
        <span class="c">#    # label = &#39;&quot;Record: %s\\n %s&quot;&#39; % (name, record.location_summary_dot_str )</span>
        <span class="c">#    label = &#39;&quot;Record: %s\\n&quot;&#39; % name  # , record.location_summary_dot_str )</span>
        <span class="c">#    n = pydot.Node(</span>
        <span class="c">#        name,</span>
        <span class="c">#        shape=&#39;circle&#39;,</span>
        <span class="c">#        style=&#39;filled&#39;,</span>
        <span class="c">#        width=&#39;0.05&#39;,</span>
        <span class="c">#        fixedsize=&#39;True&#39;,</span>
        <span class="c">#        label=label,</span>
        <span class="c">#        fontsize=fontsize,</span>
        <span class="c">#        )</span>
        <span class="c">#    records[record] = n</span>
        <span class="c">#    graph.add_node(n)</span>

        <span class="c">#    # Make the edge:</span>
        <span class="c">#    if isinstance(record, NEURONRecordableOnLocation):</span>
        <span class="c">#        post_node = obj2nodedict[record.cell_location.cell]</span>
        <span class="c">#        e = pydot.Edge(n, post_node, label=&#39;&#39;, color=&#39;green&#39;)</span>
        <span class="c">#        graph.add_edge(e)</span>

        <span class="c">#    # cell_node = obj2nodedict[record.cell_location.cell]</span>






        <span class="n">graph</span><span class="o">.</span><span class="n">write_raw</span><span class="p">(</span><span class="s">&#39;example_cluster2.dot&#39;</span><span class="p">)</span>

        <span class="c"># Put the stimulations on:</span>

        <span class="c">#fname = _DotSummaryUtils.save_dot(graph, prog=&#39;dot&#39;)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">_DotSummaryUtils</span><span class="o">.</span><span class="n">save_dot</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="s">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">prog</span><span class="o">=</span><span class="s">&#39;fdp&#39;</span><span class="p">)</span>
        <span class="c">#fname = _DotSummaryUtils.save_dot(graph, prog=&#39;osage&#39;)</span>
        <span class="c">#fname = _DotSummaryUtils.save_dot(graph, prog=&#39;neato&#39;)</span>
        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span>
                <span class="s">&#39;Diagram Overview&#39;</span><span class="p">,</span>
                <span class="n">mrd</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">mrd</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
                <span class="p">)</span></div></div>
</pre></div>

      </div>
      <div class="bottomnav">
      
        <p>
        <a class="uplink" href="../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, Mike Hull.
    </div>
  </body>
</html>