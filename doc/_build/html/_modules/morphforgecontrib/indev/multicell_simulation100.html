

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>morphforgecontrib.indev.multicell_simulation100 &mdash; morphforge</title>
    
    <link rel="stylesheet" href="../../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1-alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/theme_extras.js"></script>
    <link rel="top" title="morphforge" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../../../index.html">
          <span>morphforge</span></a></h1>
        <h2 class="heading"><span>morphforgecontrib.indev.multicell_simulation100</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a class="uplink" href="../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for morphforgecontrib.indev.multicell_simulation100</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="c"># ---------------------------------------------------------------------</span>
<span class="c"># Copyright (c) 2012 Michael Hull.</span>
<span class="c"># All rights reserved.</span>
<span class="c">#</span>
<span class="c"># Redistribution and use in source and binary forms, with or without</span>
<span class="c"># modification, are permitted provided that the following conditions</span>
<span class="c"># are met:</span>
<span class="c">#</span>
<span class="c">#  - Redistributions of source code must retain the above copyright</span>
<span class="c">#    notice, this list of conditions and the following disclaimer.</span>
<span class="c">#  - Redistributions in binary form must reproduce the above copyright</span>
<span class="c">#    notice, this list of conditions and the following disclaimer in</span>
<span class="c">#    the documentation and/or other materials provided with the</span>
<span class="c">#    distribution.</span>
<span class="c">#</span>
<span class="c"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="c"># &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="c"># LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<span class="c"># A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<span class="c"># HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<span class="c"># SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<span class="c"># LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span class="c"># DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<span class="c"># THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="c"># (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="c">#  OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c"># ----------------------------------------------------------------------</span>

<span class="kn">import</span> <span class="nn">morphforge.stdimports</span> <span class="kn">as</span> <span class="nn">mf</span>
<span class="kn">import</span> <span class="nn">morphforgecontrib.stdimports</span> <span class="kn">as</span> <span class="nn">mfc</span>
<span class="kn">import</span> <span class="nn">pylab</span>

<span class="kn">from</span> <span class="nn">morphforgecontrib.simulation.synapse_templates.neurounit</span> <span class="kn">import</span> <span class="o">*</span> 
<span class="kn">from</span> <span class="nn">morphforgecontrib.simulation.synapse_templates.exponential_form.expsyn.core</span> <span class="kn">import</span> <span class="o">*</span> 
<span class="kn">from</span> <span class="nn">morphforgecontrib.simulation.synapse_templates.exponential_form.exp2syn.core</span> <span class="kn">import</span> <span class="o">*</span> 
<span class="kn">from</span> <span class="nn">morphforgecontrib.simulation.synapse_templates.exponential_form.exp2synnmda.core</span> <span class="kn">import</span> <span class="o">*</span> 
<span class="kn">from</span> <span class="nn">morphforge</span> <span class="kn">import</span> <span class="n">units</span>

<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../../apidoc/mfi-core/morphforgecontrib.indev.html#morphforgecontrib.indev.multicell_simulation100.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>


    
    
    <span class="c"># Define the formulae used in the model:</span>
    
    <span class="n">na_eqnset_txt</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    define_component sautois_hh_na {</span>
<span class="s">        i = gmax * (v-erev) * m**3*h</span>
<span class="s">        minf = m_alpha_rate / (m_alpha_rate + m_beta_rate)</span>
<span class="s">        mtau = 1.0 / (m_alpha_rate + m_beta_rate)</span>
<span class="s">        m&#39; = (minf-m) / mtau</span>
<span class="s">        hinf = h_alpha_rate / (h_alpha_rate + h_beta_rate)</span>
<span class="s">        htau = 1.0 / (h_alpha_rate + h_beta_rate)</span>
<span class="s">        h&#39; = (hinf-h) / htau</span>
<span class="s">        StdFormAB(V, a1, a2, a3, a4, a5) = (a1+a2*V)/(a3+std.math.exp((V+a4)/a5))</span>
<span class="s">        m_alpha_rate = StdFormAB(V=v, a1=m_a1, a2=m_a2, a3=m_a3, a4=m_a4, a5=m_a5)</span>
<span class="s">        m_beta_rate =  StdFormAB(V=v, a1=m_b1, a2=m_b2, a3=m_b3, a4=m_b4, a5=m_b5)</span>
<span class="s">        h_alpha_rate = StdFormAB(V=v, a1=h_a1, a2=h_a2, a3=h_a3, a4=h_a4, a5=h_a5)</span>
<span class="s">        h_beta_rate =  StdFormAB(V=v, a1=h_b1, a2=h_b2, a3=h_b3, a4=h_b4, a5=h_b5)</span>
<span class="s">    </span>
<span class="s">        &lt;=&gt; PARAMETER m_a1:{s-1}, m_a2:{V-1 s-1}, m_a3:{}, m_a4:{V}, m_a5:{V}</span>
<span class="s">        &lt;=&gt; PARAMETER m_b1:{s-1}, m_b2:{V-1 s-1}, m_b3:{}, m_b4:{V}, m_b5:{V}</span>
<span class="s">        &lt;=&gt; PARAMETER h_a1:{s-1}, h_a2:{V-1 s-1}, h_a3:{}, h_a4:{V}, h_a5:{V}</span>
<span class="s">        &lt;=&gt; PARAMETER h_b1:{s-1}, h_b2:{V-1 s-1}, h_b3:{}, h_b4:{V}, h_b5:{V}</span>
<span class="s">        &lt;=&gt; PARAMETER gmax:(S/m2), erev:(V)</span>
<span class="s">    </span>
<span class="s">        &lt;=&gt; OUTPUT    i:(A/m2)   METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;TRANSMEMBRANECURRENT&quot;} }</span>
<span class="s">        &lt;=&gt; INPUT     v: V       METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;MEMBRANEVOLTAGE&quot;} }</span>
<span class="s">    }&quot;&quot;&quot;</span>
    
    <span class="n">lk_eqnset_txt</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    define_component sautois_hh_lk {</span>
<span class="s">        i = gmax * (v-erev)</span>
<span class="s">    </span>
<span class="s">        &lt;=&gt; PARAMETER gmax:(S/m2), erev:(V)</span>
<span class="s">    </span>
<span class="s">        &lt;=&gt; OUTPUT    i:(A/m2)   METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;TRANSMEMBRANECURRENT&quot;} }</span>
<span class="s">        &lt;=&gt; INPUT     v: V       METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;MEMBRANEVOLTAGE&quot;} }</span>
<span class="s">    }&quot;&quot;&quot;</span>
    
    <span class="n">k_eqnset_txt</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        define_component chlstd_hh_k {</span>
<span class="s">        i = gmax * (v-erev) * n</span>
<span class="s">        ninf = n_alpha_rate / (n_alpha_rate + n_beta_rate)</span>
<span class="s">        ntau = 1.0 / (n_alpha_rate + n_beta_rate)</span>
<span class="s">        n&#39; = (ninf-n) / ntau</span>
<span class="s">        StdFormAB(V, a1, a2, a3, a4, a5) = (a1 + a2*V)/(a3+std.math.exp((V+a4)/a5))</span>
<span class="s">        n_alpha_rate = StdFormAB(V=v, a1=k_a1, a2=k_a2, a3=k_a3, a4=k_a4, a5=k_a5)</span>
<span class="s">        n_beta_rate =  StdFormAB(V=v, a1=k_b1, a2=k_b2, a3=k_b3, a4=k_b4, a5=k_b5)</span>
<span class="s">    </span>
<span class="s">        &lt;=&gt; PARAMETER k_a1:{s-1}, k_a2:{V-1 s-1}, k_a3:{}, k_a4:{V}, k_a5:{V}</span>
<span class="s">        &lt;=&gt; PARAMETER k_b1:{s-1}, k_b2:{V-1 s-1}, k_b3:{}, k_b4:{V}, k_b5:{V}</span>
<span class="s">        &lt;=&gt; PARAMETER gmax:(S/m2), erev:(V)</span>
<span class="s">    </span>
<span class="s">        &lt;=&gt; OUTPUT    i:(A/m2)    METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;TRANSMEMBRANECURRENT&quot;} }</span>
<span class="s">        &lt;=&gt; INPUT     v: V        METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;MEMBRANEVOLTAGE&quot;} }</span>
<span class="s">    }&quot;&quot;&quot;</span>
    
    
    <span class="c"># Some Utility Functions:</span>
    <span class="k">def</span> <span class="nf">extract_params</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">replace_prefix</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">replace_prefix</span><span class="o">+</span><span class="n">k</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):],</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">prefix</span><span class="p">)])</span>
    
    <span class="k">def</span> <span class="nf">remap_keys</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span> <span class="n">remap_dct</span><span class="p">):</span>
        <span class="c"># Avoid collisions</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">remap_dct</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dct</span>
        <span class="k">return</span> <span class="nb">dict</span> <span class="p">([(</span><span class="n">remap_dct</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">dct</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()])</span>
    
    
    
    
    <span class="n">param_units</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    nS/um2; nS/um2; nS/um2; nS/um2;</span>
<span class="s">    mV; mV; mV; mV;</span>
<span class="s">    ms-1; mV-1 ms-1; ;mV; mV;</span>
<span class="s">    ms-1; mV-1 ms-1; ;mV; mV;</span>
<span class="s">    ms-1; mV-1 ms-1; ;mV; mV;</span>
<span class="s">    ms-1; mV-1 ms-1; ;mV; mV;</span>
<span class="s">    ms-1; mV-1 ms-1; ;mV; mV;</span>
<span class="s">    ms-1; mV-1 ms-1; ;mV; mV;</span>
<span class="s">    ms-1; mV-1 ms-1; ;mV; mV;</span>
<span class="s">    ms-1; mV-1 ms-1; ;mV; mV;</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="n">param_names</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    lk_gmax na_gmax kf_gmax ks_gmax</span>
<span class="s">    lk_erev na_erev kf_erev ks_erev</span>
<span class="s">    na_m_a1 na_m_a2 na_m_a3 na_m_a4 na_m_a5</span>
<span class="s">    na_m_b1 na_m_b2 na_m_b3 na_m_b4 na_m_b5</span>
<span class="s">    na_h_a1 na_h_a2 na_h_a3 na_h_a4 na_h_a5</span>
<span class="s">    na_h_b1 na_h_b2 na_h_b3 na_h_b4 na_h_b5</span>
<span class="s">    kf_a1 kf_a2 kf_a3 kf_a4 kf_a5</span>
<span class="s">    kf_b1 kf_b2 kf_b3 kf_b4 kf_b5</span>
<span class="s">    ks_a1 ks_a2 ks_a3 ks_a4 ks_a5</span>
<span class="s">    ks_b1 ks_b2 ks_b3 ks_b4 ks_b5</span>
<span class="s">    &quot;&quot;&quot;</span>
    
    
    <span class="c"># Param Details:</span>
    <span class="n">params_aIN</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    1.35 150 15 2.5</span>
<span class="s">    -54 50 -80  -80</span>
<span class="s">    8.67  0.00  0.50  -13.01 -18.56</span>
<span class="s">    5.73  0.00  1.00   -2.99   9.69</span>
<span class="s">    0.04  0.00  0.00   15.8   26.00</span>
<span class="s">    4.08  0.00  0.001 -19.09 -10.21</span>
<span class="s">    3.10  0.00  1.00  -35.5   -9.30</span>
<span class="s">    1.10  0.00  1.00    0.98  16.19</span>
<span class="s">    0.20  0.00  1.00  -10.96  -7.74</span>
<span class="s">    0.05  0.00  1.00  -22.07   6.10</span>
<span class="s">    &quot;&quot;&quot;</span>
    
    <span class="n">params_MN</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    2.4691 110.0 8.0 1.0</span>
<span class="s">    -61 50 -80 -80</span>
<span class="s">    13.26  0.0  0.5   -5.01 -12.56</span>
<span class="s">     5.73  0.0  1.0    5.01   9.69</span>
<span class="s">     0.04  0.0  0.0   28.8   26.0</span>
<span class="s">     2.04  0.0  0.001 -9.09 -10.21</span>
<span class="s">     3.1   0.0  1.0   -27.5   -9.3</span>
<span class="s">     0.44  0.0  1.0    8.98  16.19</span>
<span class="s">     0.20  0.0  1.0   -2.96  -7.74</span>
<span class="s">     0.05  0.0  1.0  -14.07   6.1</span>
<span class="s">    &quot;&quot;&quot;</span>
    
    <span class="n">params_dIN</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    3.6765 210.0 0.5 3.0</span>
<span class="s">    -51 50 -80 -80</span>
<span class="s">    13.01  0.0   4.0   -1.01   -12.56</span>
<span class="s">     5.73  0.0   1.0    9.01     9.69</span>
<span class="s">     0.06  0.0   0.0   30.88    26.0</span>
<span class="s">     3.06  0.0   1.0   -7.09   -10.21</span>
<span class="s">     3.10  0.0   1.0  -31.50    -9.3</span>
<span class="s">     0.44  0.0   1.0    4.98    16.19</span>
<span class="s">     0.20  0.0   1.0   -6.96    -7.74</span>
<span class="s">     0.05  0.0   2.0  -18.07     6.1</span>
<span class="s">    &quot;&quot;&quot;</span>
    
    <span class="n">params_RB</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    4.3573 120 1.5 8.0</span>
<span class="s">    -70 50 -80 -80</span>
<span class="s">    13.01  0   1   -4.01   -12.56</span>
<span class="s">     5.73  0   1   6.01     9.69</span>
<span class="s">     0.04  0   0   29.88   26.00</span>
<span class="s">     2.04  0   1   -8.09  -10.21</span>
<span class="s">     3.1   0   1   -32.5   -9.30</span>
<span class="s">     0.44  0   1   3.98    16.19</span>
<span class="s">     0.2   0   1   -7.96   -7.74</span>
<span class="s">     0.05  0   2   -19.07   6.10</span>
<span class="s">    &quot;&quot;&quot;</span>
    
    <span class="n">params_dlc</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    2.3364 420 70 10</span>
<span class="s">    -66 50 -80 -80</span>
<span class="s">    13.26  0  3.00   -3.01  -12.56</span>
<span class="s">     5.73  0  1.00    6.01    9.69</span>
<span class="s">     0.06  0  0.00   19.88   26.0</span>
<span class="s">     4.08  0  0.001  -8.09  -10.21</span>
<span class="s">     3.10  0  1.00  -32.5    -9.3</span>
<span class="s">     1.10  0  2.00    3.98   16.19</span>
<span class="s">     4.00  0  1.00  -53.0    -7.74</span>
<span class="s">     0.01  0  1.00   47.0     6.1</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="n">params_dla</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    0.6964 150 70 5</span>
<span class="s">    -63 50 -80 -80</span>
<span class="s">    13.26  0.0  1.20   -9.01 -12.56</span>
<span class="s">     5.73  0.0  1.00    1.01   9.69</span>
<span class="s">     0.04  0.0  0.00   14.88  26.00</span>
<span class="s">     2.04  0.0  0.001 -13.09 -10.21</span>
<span class="s">     3.10  0.0  1.00  -37.5   -9.3</span>
<span class="s">     1.10  0.0  0.60   -1.02  16.19</span>
<span class="s">     4.00  0.0  1.00  -58.0   -7.74</span>
<span class="s">     0.01  0.0  1.00   42.0    6.1</span>
<span class="s">    &quot;&quot;&quot;</span>
    
    <span class="n">params_cIN</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    4.8544 500 30 20</span>
<span class="s">    -60 50 -80 -80</span>
<span class="s">    13.26  0  0.1   -10.01 -12.56</span>
<span class="s">     5.73  0  1       0.01   9.69</span>
<span class="s">     0.06  0  0      23.8   26.0</span>
<span class="s">     3.06  0  0.001 -14.09 -10.21</span>
<span class="s">     3.10  0  1     -32.5   -9.3</span>
<span class="s">     1.10  0  1       3.98  16.19</span>
<span class="s">     0.20  0  1      -7.96  -7.74</span>
<span class="s">     0.05  0  0.5   -19.07   6.1</span>
<span class="s">    &quot;&quot;&quot;</span>
    <span class="n">params_dINr</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    4.807 190 20 3</span>
<span class="s">    -59 50 -80 -80</span>
<span class="s">    12.3  0  0.1  -10.01  -12.56</span>
<span class="s">    3.73  0  1.0    0.01    9.69</span>
<span class="s">    0.04  0  0.0   23.8    26.0</span>
<span class="s">    2.04  0  0.3  -18.09  -10.21</span>
<span class="s">    3.10  0  1.0  -32.5    -9.3</span>
<span class="s">    1.10  0  1.0    3.98   16.19</span>
<span class="s">    0.20  0  0.5   -7.96   -7.74</span>
<span class="s">    0.05  0  0.7  -19.07    6.1</span>
<span class="s">    &quot;&quot;&quot;</span>
    
    
    <span class="k">def</span> <span class="nf">load_std_channels</span><span class="p">(</span><span class="n">param_str</span><span class="p">):</span>
        <span class="n">nrn_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">p</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">qty</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">strip</span><span class="p">())))</span> <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">param_names</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">param_units</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">),</span> <span class="n">param_str</span><span class="o">.</span><span class="n">split</span><span class="p">())])</span>
        <span class="n">nrn_params_na</span> <span class="o">=</span> <span class="n">extract_params</span><span class="p">(</span><span class="n">nrn_params</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;na_&#39;</span><span class="p">)</span>
        <span class="n">nrn_params_lk</span> <span class="o">=</span> <span class="n">extract_params</span><span class="p">(</span><span class="n">nrn_params</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;lk_&#39;</span><span class="p">)</span>
        <span class="n">nrn_params_ks</span> <span class="o">=</span> <span class="n">extract_params</span><span class="p">(</span><span class="n">nrn_params</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;ks_&#39;</span><span class="p">,</span> <span class="n">replace_prefix</span><span class="o">=</span><span class="s">&#39;k_&#39;</span><span class="p">)</span>
        <span class="n">nrn_params_kf</span> <span class="o">=</span> <span class="n">extract_params</span><span class="p">(</span><span class="n">nrn_params</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;kf_&#39;</span><span class="p">,</span> <span class="n">replace_prefix</span><span class="o">=</span><span class="s">&#39;k_&#39;</span><span class="p">)</span>
        <span class="n">nrn_params_ks</span> <span class="o">=</span> <span class="n">remap_keys</span><span class="p">(</span><span class="n">nrn_params_ks</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;k_gmax&#39;</span><span class="p">:</span><span class="s">&#39;gmax&#39;</span><span class="p">,</span> <span class="s">&#39;k_erev&#39;</span><span class="p">:</span><span class="s">&#39;erev&#39;</span><span class="p">})</span>
        <span class="n">nrn_params_kf</span> <span class="o">=</span> <span class="n">remap_keys</span><span class="p">(</span><span class="n">nrn_params_kf</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;k_gmax&#39;</span><span class="p">:</span><span class="s">&#39;gmax&#39;</span><span class="p">,</span> <span class="s">&#39;k_erev&#39;</span><span class="p">:</span><span class="s">&#39;erev&#39;</span><span class="p">})</span>
        <span class="n">eqnsetna</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">neurounits</span><span class="o">.</span><span class="n">NeuroUnitParser</span><span class="o">.</span><span class="n">Parse9MLFile</span><span class="p">(</span><span class="n">na_eqnset_txt</span><span class="p">)</span><span class="o">.</span><span class="n">get_component</span><span class="p">()</span>
        <span class="n">eqnsetlk</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">neurounits</span><span class="o">.</span><span class="n">NeuroUnitParser</span><span class="o">.</span><span class="n">Parse9MLFile</span><span class="p">(</span><span class="n">lk_eqnset_txt</span><span class="p">)</span><span class="o">.</span><span class="n">get_component</span><span class="p">()</span>
        <span class="n">eqnsetk</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">neurounits</span><span class="o">.</span><span class="n">NeuroUnitParser</span><span class="o">.</span><span class="n">Parse9MLFile</span><span class="p">(</span><span class="n">k_eqnset_txt</span><span class="p">)</span><span class="o">.</span><span class="n">get_component</span><span class="p">()</span>
    
        <span class="n">na_chl</span> <span class="o">=</span> <span class="n">mfc</span><span class="o">.</span><span class="n">Neuron_NeuroUnitEqnsetMechanism</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Chl1&quot;</span><span class="p">,</span> <span class="n">eqnset</span><span class="o">=</span><span class="n">eqnsetna</span><span class="p">,</span> <span class="n">default_parameters</span> <span class="o">=</span> <span class="n">nrn_params_na</span><span class="p">)</span>
        <span class="n">lk_chl</span> <span class="o">=</span> <span class="n">mfc</span><span class="o">.</span><span class="n">Neuron_NeuroUnitEqnsetMechanism</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Chl2&quot;</span><span class="p">,</span> <span class="n">eqnset</span><span class="o">=</span><span class="n">eqnsetlk</span><span class="p">,</span> <span class="n">default_parameters</span> <span class="o">=</span> <span class="n">nrn_params_lk</span><span class="p">)</span>
        <span class="n">ksChls</span> <span class="o">=</span> <span class="n">mfc</span><span class="o">.</span><span class="n">Neuron_NeuroUnitEqnsetMechanism</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Chl3&quot;</span><span class="p">,</span> <span class="n">eqnset</span><span class="o">=</span><span class="n">eqnsetk</span><span class="p">,</span>  <span class="n">default_parameters</span> <span class="o">=</span> <span class="n">nrn_params_ks</span><span class="p">)</span>
        <span class="n">kfChls</span> <span class="o">=</span> <span class="n">mfc</span><span class="o">.</span><span class="n">Neuron_NeuroUnitEqnsetMechanism</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Chl4&quot;</span><span class="p">,</span> <span class="n">eqnset</span><span class="o">=</span><span class="n">eqnsetk</span><span class="p">,</span>  <span class="n">default_parameters</span> <span class="o">=</span> <span class="n">nrn_params_kf</span><span class="p">)</span>
    
        <span class="n">chls</span> <span class="o">=</span>  <span class="p">[</span><span class="n">na_chl</span><span class="p">,</span> <span class="n">lk_chl</span><span class="p">,</span> <span class="n">ksChls</span><span class="p">,</span> <span class="n">kfChls</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">chls</span>
    
    
    
    <span class="k">def</span> <span class="nf">load_ka_channel</span><span class="p">():</span>
        <span class="n">ka_param_names</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        ka_gmax ka_erev</span>
<span class="s">        ka_m_a1 ka_m_a2 ka_m_a3 ka_m_a4 ka_m_a5</span>
<span class="s">        ka_m_b1 ka_m_b2 ka_m_b3 ka_m_b4 ka_m_b5</span>
<span class="s">        ka_h_a1 ka_h_a2 ka_h_a3 ka_h_a4 ka_h_a5</span>
<span class="s">        ka_h_b1 ka_h_b2 ka_h_b3 ka_h_b4 ka_h_b5</span>
<span class="s">        &quot;&quot;&quot;</span>
    
        <span class="n">ka_param_units</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        nS/um2; mV;</span>
<span class="s">        ms-1; mV-1 ms-1; ;mV; mV;</span>
<span class="s">        ms-1; mV-1 ms-1; ;mV; mV;</span>
<span class="s">        ms-1; mV-1 ms-1; ;mV; mV;</span>
<span class="s">        ms-1; mV-1 ms-1; ;mV; mV;</span>
<span class="s">        &quot;&quot;&quot;</span>
        <span class="n">ka_param_str</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        30   -80</span>
<span class="s">        12.025   0   0.5 -10.01  -12.56</span>
<span class="s">        14.325   0   1    -8.01    9.69</span>
<span class="s">        0.0001   0   1    15.88   26.0</span>
<span class="s">        10.000   0   500 -22.09  -10.21</span>
<span class="s">        &quot;&quot;&quot;</span>
    
        <span class="n">nrn_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">p</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">qty</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">strip</span><span class="p">())))</span> <span class="k">for</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ka_param_names</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">ka_param_units</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">),</span> <span class="n">ka_param_str</span><span class="o">.</span><span class="n">split</span><span class="p">())])</span>
        <span class="n">nrn_params_ka</span> <span class="o">=</span> <span class="n">extract_params</span><span class="p">(</span><span class="n">nrn_params</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;ka_&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">nrn_params_ka</span>
        <span class="n">eqnsetka</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">neurounits</span><span class="o">.</span><span class="n">NeuroUnitParser</span><span class="o">.</span><span class="n">Parse9MLFile</span><span class="p">(</span><span class="n">ka_eqnset_txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;sautois&quot;</span><span class="p">,</span> <span class="s">&quot;saut2&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">get_component</span><span class="p">()</span>
        <span class="n">kaChls</span> <span class="o">=</span> <span class="n">mfc</span><span class="o">.</span><span class="n">Neuron_NeuroUnitEqnsetMechanism</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Chl5&quot;</span><span class="p">,</span> <span class="n">eqnset</span><span class="o">=</span><span class="n">eqnsetka</span><span class="p">,</span>  <span class="n">default_parameters</span> <span class="o">=</span> <span class="n">nrn_params_ka</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kaChls</span>
    
    
    <span class="nd">@mf.cached_functor</span>
    <span class="k">def</span> <span class="nf">get_ain_chls</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">load_std_channels</span><span class="p">(</span><span class="n">params_aIN</span><span class="p">)</span>
    <span class="nd">@mf.cached_functor</span>
    <span class="k">def</span> <span class="nf">get_mn_chls</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">load_std_channels</span><span class="p">(</span><span class="n">params_MN</span><span class="p">)</span>
    <span class="nd">@mf.cached_functor</span>
    <span class="k">def</span> <span class="nf">get_dinr_chls</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">load_std_channels</span><span class="p">(</span><span class="n">params_dINr</span><span class="p">)</span>
    <span class="nd">@mf.cached_functor</span>
    <span class="k">def</span> <span class="nf">get_din_chls</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">load_std_channels</span><span class="p">(</span><span class="n">params_dIN</span><span class="p">)</span>
    <span class="nd">@mf.cached_functor</span>
    <span class="k">def</span> <span class="nf">get_rb_chls</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">load_std_channels</span><span class="p">(</span><span class="n">params_RB</span><span class="p">)</span>
    <span class="nd">@mf.cached_functor</span>
    <span class="k">def</span> <span class="nf">get_dla_chls</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">load_std_channels</span><span class="p">(</span><span class="n">params_dla</span><span class="p">)</span>
    <span class="nd">@mf.cached_functor</span>
    <span class="k">def</span> <span class="nf">get_dlc_chls</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">load_std_channels</span><span class="p">(</span><span class="n">params_dlc</span><span class="p">)</span>
    <span class="nd">@mf.cached_functor</span>
    <span class="k">def</span> <span class="nf">get_cin_chls</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">load_std_channels</span><span class="p">(</span><span class="n">params_cIN</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">load_ka_channel</span><span class="p">()]</span>
    
    
    <span class="kn">import</span> <span class="nn">random</span>
    <span class="k">def</span> <span class="nf">make_cell</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">cell_name</span><span class="p">,</span> <span class="n">cell_chl_functor</span><span class="p">):</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">MorphologyBuilder</span><span class="o">.</span><span class="n">get_single_section_soma</span><span class="p">(</span><span class="n">area</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">qty</span><span class="p">(</span><span class="s">&quot;1:um2&quot;</span><span class="p">))</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">create_cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">cell_name</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="n">m1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">chl</span> <span class="ow">in</span> <span class="n">cell_chl_functor</span><span class="p">():</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">apply_channel</span><span class="p">(</span> <span class="n">chl</span><span class="p">,</span> <span class="n">parameter_multipliers</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;gmax&#39;</span><span class="p">:</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)})</span>
        <span class="n">cell</span><span class="o">.</span><span class="n">set_passive</span><span class="p">(</span> <span class="n">mf</span><span class="o">.</span><span class="n">PassiveProperty</span><span class="o">.</span><span class="n">SpecificCapacitance</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">qty</span><span class="p">(</span><span class="s">&#39;4:pF/um2&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">cell</span>
    
    
    <span class="k">def</span> <span class="nf">make_cell_ain</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cell_tags</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">return</span> <span class="n">make_cell</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">cell_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">cell_chl_functor</span><span class="o">=</span> <span class="n">get_ain_chls</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">make_cell_cin</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cell_tags</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">return</span> <span class="n">make_cell</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">cell_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">cell_chl_functor</span><span class="o">=</span> <span class="n">get_cin_chls</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">make_cell_din</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cell_tags</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">return</span> <span class="n">make_cell</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">cell_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">cell_chl_functor</span><span class="o">=</span> <span class="n">get_din_chls</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">make_cell_dinr</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cell_tags</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">return</span> <span class="n">make_cell</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">cell_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">cell_chl_functor</span><span class="o">=</span> <span class="n">get_dinr_chls</span><span class="p">)</span>
    
    
    
    <span class="n">celltypes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">&#39;aIN&#39;</span><span class="p">,</span> <span class="n">get_ain_chls</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;MN&#39;</span><span class="p">,</span>  <span class="n">get_mn_chls</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;dIN&#39;</span><span class="p">,</span> <span class="n">get_din_chls</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;RB&#39;</span><span class="p">,</span>  <span class="n">get_rb_chls</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;dla&#39;</span><span class="p">,</span> <span class="n">get_dla_chls</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;dlc&#39;</span><span class="p">,</span> <span class="n">get_dlc_chls</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;cIN&#39;</span><span class="p">,</span> <span class="n">get_cin_chls</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;dINr&#39;</span><span class="p">,</span> <span class="n">get_dinr_chls</span><span class="p">),</span>
    <span class="p">]</span>
    
    
    
    
    
    
    <span class="c"># Test the effects of step-current injections:</span>
    <span class="c"># ############################################</span>
    
    <span class="k">def</span> <span class="nf">test_cell_current</span><span class="p">(</span><span class="n">cell_name</span><span class="p">,</span> <span class="n">cell_chl_functor</span><span class="p">,</span> <span class="n">current</span><span class="p">):</span>
        <span class="n">sim</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">NEURONEnvironment</span><span class="p">()</span><span class="o">.</span><span class="n">Simulation</span><span class="p">()</span>
    
        <span class="n">m1</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">MorphologyBuilder</span><span class="o">.</span><span class="n">get_single_section_soma</span><span class="p">(</span><span class="n">area</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">qty</span><span class="p">(</span><span class="s">&quot;1:um2&quot;</span><span class="p">))</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">create_cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">cell_name</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="n">m1</span><span class="p">)</span>
        <span class="n">cc</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">create_currentclamp</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;CC1&quot;</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">dur</span><span class="o">=</span><span class="mi">400</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="n">current</span> <span class="o">*</span> <span class="n">mf</span><span class="o">.</span><span class="n">pA</span><span class="p">,</span> <span class="n">cell_location</span><span class="o">=</span><span class="n">cell</span><span class="o">.</span><span class="n">soma</span><span class="p">)</span>
    
        <span class="k">for</span> <span class="n">chl</span> <span class="ow">in</span> <span class="n">cell_chl_functor</span><span class="p">():</span>
            <span class="n">mf</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">apply_channel</span><span class="p">(</span> <span class="n">chl</span><span class="p">)</span>
    
        <span class="n">mf</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">set_passive</span><span class="p">(</span> <span class="n">mf</span><span class="o">.</span><span class="n">PassiveProperty</span><span class="o">.</span><span class="n">SpecificCapacitance</span><span class="p">,</span> <span class="n">mf</span><span class="o">.</span><span class="n">qty</span><span class="p">(</span><span class="s">&#39;4:pF/um2&#39;</span><span class="p">))</span>
    
        <span class="n">sim</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">Cell</span><span class="o">.</span><span class="n">Recordables</span><span class="o">.</span><span class="n">MembraneVoltage</span><span class="p">)</span>
        <span class="n">sim</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">what</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">CurrentClamp</span><span class="o">.</span><span class="n">Recordables</span><span class="o">.</span><span class="n">Current</span><span class="p">)</span>
    
        <span class="n">res</span> <span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">res</span>
    
    
    <span class="k">def</span> <span class="nf">test_cell</span><span class="p">(</span><span class="n">cell_name</span><span class="p">,</span> <span class="n">cell_chl_functor</span><span class="p">):</span>
        <span class="n">current_levels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">240</span><span class="p">]</span>
        <span class="n">reses</span> <span class="o">=</span> <span class="p">[</span><span class="n">test_cell_current</span><span class="p">(</span><span class="n">cell_name</span><span class="o">=</span><span class="n">cell_name</span><span class="p">,</span> <span class="n">cell_chl_functor</span><span class="o">=</span><span class="n">cell_chl_functor</span><span class="p">,</span> <span class="n">current</span><span class="o">=</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">current_levels</span><span class="p">]</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">TagViewer</span><span class="p">(</span><span class="n">reses</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">test_step_current_injections</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">cell_name</span><span class="p">,</span> <span class="n">functor</span> <span class="ow">in</span> <span class="n">celltypes</span><span class="p">:</span>
            <span class="n">test_cell</span><span class="p">(</span><span class="n">cell_name</span><span class="p">,</span> <span class="n">functor</span><span class="p">)</span>
    
    <span class="c"># End of step current injections</span>
    <span class="c">################################</span>
    
    
    
    
    <span class="n">simple_syn</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    define_component syn_simple {</span>
<span class="s">    </span>
<span class="s">        g&#39; = - g/g_tau</span>
<span class="s">        i = gmax * (v-erev) * g</span>
<span class="s">    </span>
<span class="s">        gmax = 300pS</span>
<span class="s">        erev = 0mV</span>
<span class="s">    </span>
<span class="s">        g_tau = 20ms</span>
<span class="s">        &lt;=&gt; INPUT     v: mV       METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;MEMBRANEVOLTAGE&quot;} }</span>
<span class="s">        &lt;=&gt; OUTPUT    i:(mA)      METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;TRANSMEMBRANECURRENT&quot;} }</span>
<span class="s">    </span>
<span class="s">        on on_event() {</span>
<span class="s">            g = g + 1.0</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">    &quot;&quot;&quot;</span>
    
    
    <span class="n">syn_inhib</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    define_component syn_decaying_inhib {</span>
<span class="s">        o&#39; = - o/{1.5 ms}</span>
<span class="s">        c&#39; = - c/{4.0 ms}</span>
<span class="s">        i = (v- {-80mV}) *g</span>
<span class="s">        g = {0.435nS}  * (c-o)  * scale</span>
<span class="s">        x=10.0</span>
<span class="s">        f = scale</span>
<span class="s">        plas&#39; = -plas / beta</span>
<span class="s">    </span>
<span class="s">        &lt;=&gt; PARAMETER scale:()</span>
<span class="s">        &lt;=&gt; INPUT     v: mV       METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;MEMBRANEVOLTAGE&quot;} }</span>
<span class="s">        &lt;=&gt; OUTPUT    i:(mA)      METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;TRANSMEMBRANECURRENT&quot;} }</span>
<span class="s">    </span>
<span class="s">        alpha = 0.75</span>
<span class="s">        beta = 60ms</span>
<span class="s">        update = x - (x * (1-alpha) * plas)</span>
<span class="s">        on on_event() {</span>
<span class="s">            #update = x - (x * (1-alpha) * plas)</span>
<span class="s">            o = o + [update]if[update&gt;0]else[0]</span>
<span class="s">            c = c + [update]if[update&gt;0]else[0]</span>
<span class="s">    </span>
<span class="s">            plas = plas + 1.0</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">    &quot;&quot;&quot;</span>
    
    
    
    <span class="n">syn_onto_driver</span><span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    define_component syn_simple {</span>
<span class="s">    </span>
<span class="s">        o&#39; = - o/{1.5 ms}</span>
<span class="s">        c&#39; = - c/{10.0 s}</span>
<span class="s">        i = {0.835nS} * (v- {0mV})  * (c-o) * scale</span>
<span class="s">    </span>
<span class="s">        &lt;=&gt; PARAMETER scale:()</span>
<span class="s">        &lt;=&gt; INPUT     v: mV       METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;MEMBRANEVOLTAGE&quot;} }</span>
<span class="s">        &lt;=&gt; OUTPUT    i:(mA)      METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;TRANSMEMBRANECURRENT&quot;} }</span>
<span class="s">    </span>
<span class="s">        on on_event() {</span>
<span class="s">            o = o +  10</span>
<span class="s">            c = c +  10</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">    &quot;&quot;&quot;</span>
    
    <span class="n">syn_std_excite_AMPA</span><span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    define_component syn_simple {</span>
<span class="s">    </span>
<span class="s">        o&#39; = - o/{1.5 ms}</span>
<span class="s">        c&#39; = - c/{4.0 ms}</span>
<span class="s">        i = {0.435nS} * (v- {0mV})  * (c-o)  * scale</span>
<span class="s">    </span>
<span class="s">        &lt;=&gt; PARAMETER scale:()</span>
<span class="s">        &lt;=&gt; INPUT     v: mV       METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;MEMBRANEVOLTAGE&quot;} }</span>
<span class="s">        &lt;=&gt; OUTPUT    i:(mA)      METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;TRANSMEMBRANECURRENT&quot;} }</span>
<span class="s">    </span>
<span class="s">        on on_event() {</span>
<span class="s">            o = o + 10</span>
<span class="s">            c = c + 10</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">    &quot;&quot;&quot;</span>
    
    <span class="n">syn_std_excite_NMDA</span><span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    define_component syn_simple {</span>
<span class="s">    </span>
<span class="s">        o&#39; = - o/{1.5 ms}</span>
<span class="s">        c&#39; = - c/{80 ms}</span>
<span class="s">        i = {0.435nS} * (v- {0mV})  * (c-o)  * scale  * vdep</span>
<span class="s">        vdep = 1/(1+ 0.1*0.5*std.math.exp(-0.08*v/{1mV}))</span>
<span class="s">    </span>
<span class="s">        &lt;=&gt; PARAMETER scale:()</span>
<span class="s">        &lt;=&gt; INPUT     v: mV       METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;MEMBRANEVOLTAGE&quot;} }</span>
<span class="s">        &lt;=&gt; OUTPUT    i:(mA)      METADATA {&quot;mf&quot;:{&quot;role&quot;:&quot;TRANSMEMBRANECURRENT&quot;} }</span>
<span class="s">    </span>
<span class="s">        on on_event() {</span>
<span class="s">            o = [o + 10]if[o&lt;15]else[25]</span>
<span class="s">            c = [c + 10]if[c&lt;15]else[25]</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">    &quot;&quot;&quot;</span>
    
    
    <span class="n">env</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">NEURONEnvironment</span><span class="p">()</span>
    
    
    <span class="c"># Create the synaptic templates:</span>
    <span class="n">driver_syn_tmpl</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">PostSynapticMechTemplate</span><span class="p">(</span>
            <span class="n">NeuroUnitEqnsetPostSynaptic</span><span class="p">,</span>
            <span class="n">eqnset</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">neurounits</span><span class="o">.</span><span class="n">NeuroUnitParser</span><span class="o">.</span><span class="n">Parse9MLFile</span><span class="p">(</span><span class="n">syn_onto_driver</span><span class="p">)</span><span class="o">.</span><span class="n">get_component</span><span class="p">(),</span> 
            <span class="n">template_name</span><span class="o">=</span><span class="s">&#39;driver_syn_templ&#39;</span><span class="p">,</span>
            <span class="n">default_parameters</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;scale&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">}</span> 
            <span class="p">)</span>
    
    <span class="n">excite_ampa_syn_tmpl</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">PostSynapticMechTemplate</span><span class="p">(</span>
            <span class="n">NeuroUnitEqnsetPostSynaptic</span><span class="p">,</span>
            <span class="n">template_name</span><span class="o">=</span><span class="s">&#39;excite_ampa_syn_tmpl&#39;</span><span class="p">,</span>
            <span class="n">eqnset</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">neurounits</span><span class="o">.</span><span class="n">NeuroUnitParser</span><span class="o">.</span><span class="n">Parse9MLFile</span><span class="p">(</span><span class="n">syn_std_excite_AMPA</span><span class="p">)</span><span class="o">.</span><span class="n">get_component</span><span class="p">(),</span> 
            <span class="n">default_parameters</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;scale&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">}</span> 
            <span class="p">)</span>
    
    <span class="n">excite_nmda_syn_tmpl</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">PostSynapticMechTemplate</span><span class="p">(</span>
            <span class="n">NeuroUnitEqnsetPostSynaptic</span><span class="p">,</span>
            <span class="n">template_name</span><span class="o">=</span><span class="s">&#39;excite_nmda_syn_tmpl&#39;</span><span class="p">,</span>
            <span class="n">eqnset</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">neurounits</span><span class="o">.</span><span class="n">NeuroUnitParser</span><span class="o">.</span><span class="n">Parse9MLFile</span><span class="p">(</span><span class="n">syn_std_excite_NMDA</span><span class="p">)</span><span class="o">.</span><span class="n">get_component</span><span class="p">(),</span> 
            <span class="n">default_parameters</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;scale&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">}</span> 
            <span class="p">)</span>
    
    <span class="n">inhib_syn_tmpl</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">PostSynapticMechTemplate</span><span class="p">(</span>
            <span class="n">NeuroUnitEqnsetPostSynaptic</span><span class="p">,</span>
            <span class="n">template_name</span><span class="o">=</span><span class="s">&#39;inhib_syn_tmpl&#39;</span><span class="p">,</span>
            <span class="n">eqnset</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">neurounits</span><span class="o">.</span><span class="n">NeuroUnitParser</span><span class="o">.</span><span class="n">Parse9MLFile</span><span class="p">(</span><span class="n">syn_inhib</span><span class="p">)</span><span class="o">.</span><span class="n">get_component</span><span class="p">(),</span> 
            <span class="n">default_parameters</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;scale&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">}</span> 
            <span class="p">)</span>
    
    <span class="n">exptemplate</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">PostSynapticMechTemplate</span><span class="p">(</span>
            <span class="n">PostSynapticMech_ExpSyn_Base</span><span class="p">,</span>
            <span class="n">template_name</span><span class="o">=</span><span class="s">&#39;expsyn1tmpl&#39;</span><span class="p">,</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> 
            <span class="n">e_rev</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mV</span><span class="p">,</span>
            <span class="n">peak_conductance</span> <span class="o">=</span> <span class="mi">300</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">pS</span>
            <span class="p">)</span>
    
    
    <span class="n">exp2template</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">PostSynapticMechTemplate</span><span class="p">(</span>
            <span class="n">PostSynapticMech_Exp2Syn_Base</span><span class="p">,</span>
            <span class="n">template_name</span><span class="o">=</span><span class="s">&#39;expsyn2tmpl&#39;</span><span class="p">,</span>
            <span class="n">tau_open</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">tau_close</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">e_rev</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">mV</span><span class="p">,</span> <span class="n">popening</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">peak_conductance</span> <span class="o">=</span> <span class="mi">300</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">pS</span>
            <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">build_trigger</span><span class="p">(</span> <span class="n">env</span><span class="p">,</span> <span class="n">cell</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">env</span><span class="o">.</span><span class="n">SynapticTrigger</span><span class="p">(</span>
                    <span class="n">mfc</span><span class="o">.</span><span class="n">SynapticTriggerByVoltageThreshold</span><span class="p">,</span>
                    <span class="n">cell_location</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">soma</span><span class="p">,</span>
                    <span class="n">voltage_threshold</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">qty</span><span class="p">(</span><span class="s">&quot;0:mV&quot;</span><span class="p">),</span>
                    <span class="n">delay</span> <span class="o">=</span> <span class="n">mf</span><span class="o">.</span><span class="n">qty</span><span class="p">(</span><span class="s">&quot;1:ms&quot;</span><span class="p">),</span>
                    <span class="c">#,</span>
                   <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">onto_driver</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sim</span><span class="o">.</span><span class="n">create_synapse</span><span class="p">(</span>
                <span class="n">trigger</span> <span class="o">=</span>  <span class="n">env</span><span class="o">.</span><span class="n">SynapticTrigger</span><span class="p">(</span>
                                            <span class="n">mfc</span><span class="o">.</span><span class="n">SynapticTriggerAtTimes</span><span class="p">,</span>
                                            <span class="n">time_list</span> <span class="o">=</span>   <span class="n">times</span><span class="p">,</span>
                                            <span class="p">),</span>
                <span class="n">postsynaptic_mech</span> <span class="o">=</span> <span class="n">driver_syn_tmpl</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span>
                                            <span class="n">cell_location</span> <span class="o">=</span> <span class="n">postsynaptic</span><span class="o">.</span><span class="n">soma</span><span class="p">,</span>
                                            <span class="n">parameter_multipliers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;scale&#39;</span><span class="p">:</span><span class="mf">1.0</span> <span class="p">},</span>
                                            <span class="c">#peak_conductance = mf.qty(&quot;1:nS&quot;)</span>
                                           <span class="p">)</span>
               <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">dual_driver</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="p">,</span> <span class="n">ampa_scale</span><span class="p">,</span> <span class="n">nmda_scale</span><span class="p">):</span>
        <span class="n">ampa</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">create_synapse</span><span class="p">(</span>
                <span class="n">trigger</span> <span class="o">=</span> <span class="n">build_trigger</span><span class="p">(</span> <span class="n">env</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">),</span>
                <span class="n">postsynaptic_mech</span> <span class="o">=</span> <span class="n">excite_ampa_syn_tmpl</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span>
                                            <span class="n">cell_location</span> <span class="o">=</span> <span class="n">postsynaptic</span><span class="o">.</span><span class="n">soma</span><span class="p">,</span>
                                            <span class="n">parameter_multipliers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;scale&#39;</span><span class="p">:</span><span class="n">ampa_scale</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">dimensionless</span> <span class="p">},</span>
                                            <span class="c">#peak_conductance = mf.qty(&quot;1:nS&quot;)</span>
                                           <span class="p">)</span>
               <span class="p">)</span>
        <span class="n">nmda</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">create_synapse</span><span class="p">(</span>
                <span class="n">trigger</span> <span class="o">=</span> <span class="n">build_trigger</span><span class="p">(</span> <span class="n">env</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">),</span>
                <span class="n">postsynaptic_mech</span> <span class="o">=</span> <span class="n">excite_nmda_syn_tmpl</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span>
                                            <span class="n">cell_location</span> <span class="o">=</span> <span class="n">postsynaptic</span><span class="o">.</span><span class="n">soma</span><span class="p">,</span>
                                            <span class="n">parameter_multipliers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;scale&#39;</span><span class="p">:</span><span class="n">nmda_scale</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">dimensionless</span> <span class="p">},</span>
                                            <span class="c">#peak_conductance = mf.qty(&quot;1:nS&quot;)</span>
                                           <span class="p">)</span>
               <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ampa</span><span class="p">,</span> <span class="n">nmda</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">inhib</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="n">inhib_syn</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">create_synapse</span><span class="p">(</span>
                <span class="n">trigger</span> <span class="o">=</span> <span class="n">build_trigger</span><span class="p">(</span> <span class="n">env</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">),</span>
                <span class="n">postsynaptic_mech</span> <span class="o">=</span> <span class="n">inhib_syn_tmpl</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span>
                                            <span class="n">cell_location</span> <span class="o">=</span> <span class="n">postsynaptic</span><span class="o">.</span><span class="n">soma</span><span class="p">,</span>
                                            <span class="n">parameter_multipliers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;scale&#39;</span><span class="p">:</span><span class="n">scale</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">dimensionless</span> <span class="p">},</span>
                                           <span class="p">)</span>
               <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">inhib_syn</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">expbuiltin_syn</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="n">inhib_syn</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">create_synapse</span><span class="p">(</span>
                <span class="n">trigger</span> <span class="o">=</span> <span class="n">build_trigger</span><span class="p">(</span> <span class="n">env</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">),</span>
                <span class="n">postsynaptic_mech</span> <span class="o">=</span> <span class="n">exptemplate</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span> <span class="n">cell_location</span> <span class="o">=</span> <span class="n">postsynaptic</span><span class="o">.</span><span class="n">soma</span><span class="p">,)</span>
               <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">inhib_syn</span><span class="p">]</span>
    
    
    <span class="k">def</span> <span class="nf">exp2builtin_syn</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="n">inhib_syn</span> <span class="o">=</span> <span class="n">sim</span><span class="o">.</span><span class="n">create_synapse</span><span class="p">(</span>
                <span class="n">trigger</span> <span class="o">=</span> <span class="n">build_trigger</span><span class="p">(</span> <span class="n">env</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">),</span>
                <span class="n">postsynaptic_mech</span> <span class="o">=</span> <span class="n">exp2template</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span> <span class="n">cell_location</span> <span class="o">=</span> <span class="n">postsynaptic</span><span class="o">.</span><span class="n">soma</span><span class="p">,)</span>
               <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">inhib_syn</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">driver_onto_dinr</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dual_driver</span><span class="p">(</span><span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="o">=</span><span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="o">=</span><span class="n">postsynaptic</span><span class="p">,</span> <span class="n">ampa_scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">nmda_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">driver_onto_cin</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dual_driver</span><span class="p">(</span><span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="o">=</span><span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="o">=</span><span class="n">postsynaptic</span><span class="p">,</span> <span class="n">ampa_scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">nmda_scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">dinr_onto_cin</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">dual_driver</span><span class="p">(</span><span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="o">=</span><span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="o">=</span><span class="n">postsynaptic</span><span class="p">,</span> <span class="n">ampa_scale</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">nmda_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">cin_onto_cin</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">inhib</span><span class="p">(</span><span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="o">=</span><span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="o">=</span><span class="n">postsynaptic</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">cin_onto_dinr</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">inhib</span><span class="p">(</span><span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="o">=</span><span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="o">=</span><span class="n">postsynaptic</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">expbuiltin</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expbuiltin_syn</span><span class="p">(</span><span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="o">=</span><span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="o">=</span><span class="n">postsynaptic</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">exp2builtin</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">exp2builtin_syn</span><span class="p">(</span><span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic</span><span class="o">=</span><span class="n">presynaptic</span><span class="p">,</span> <span class="n">postsynaptic</span><span class="o">=</span><span class="n">postsynaptic</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>
    
    
    
    <span class="n">sim</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">Simulation</span><span class="p">()</span>
    
    <span class="n">nNeurons</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">dINr_LHS</span> <span class="o">=</span><span class="n">mfc</span><span class="o">.</span><span class="n">NeuronPopulation</span><span class="p">(</span><span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span> <span class="n">neuron_functor</span><span class="o">=</span><span class="n">make_cell_dinr</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pop_name</span><span class="o">=</span><span class="s">&quot;dINR_LHS&quot;</span><span class="p">)</span>
    <span class="n">dINr_RHS</span> <span class="o">=</span><span class="n">mfc</span><span class="o">.</span><span class="n">NeuronPopulation</span><span class="p">(</span><span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span> <span class="n">neuron_functor</span><span class="o">=</span><span class="n">make_cell_dinr</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pop_name</span><span class="o">=</span><span class="s">&quot;dINR_RHS&quot;</span><span class="p">)</span>
    
    <span class="n">cIN_LHS</span> <span class="o">=</span><span class="n">mfc</span><span class="o">.</span><span class="n">NeuronPopulation</span><span class="p">(</span><span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span> <span class="n">neuron_functor</span><span class="o">=</span><span class="n">make_cell_dinr</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pop_name</span><span class="o">=</span><span class="s">&quot;cIN_LHS&quot;</span><span class="p">)</span>
    <span class="n">cIN_RHS</span> <span class="o">=</span><span class="n">mfc</span><span class="o">.</span><span class="n">NeuronPopulation</span><span class="p">(</span><span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span> <span class="n">neuron_functor</span><span class="o">=</span><span class="n">make_cell_dinr</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pop_name</span><span class="o">=</span><span class="s">&quot;cIN_RHS&quot;</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="c">#aIN_LHS =mfc.NeuronPopulation(sim=sim, neuron_functor=make_cell_ain, n=nNeurons, pop_name=&quot;aIN_LHS&quot;)</span>
    <span class="c">#aIN_RHS =mfc.NeuronPopulation(sim=sim, neuron_functor=make_cell_ain, n=nNeurons, pop_name=&quot;aIN_RHS&quot;)</span>
    
    
    <span class="n">driver_LHS</span> <span class="o">=</span><span class="n">mfc</span><span class="o">.</span><span class="n">NeuronPopulation</span><span class="p">(</span><span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span> <span class="n">neuron_functor</span><span class="o">=</span><span class="n">make_cell_dinr</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">nNeurons</span><span class="p">,</span> <span class="n">pop_name</span><span class="o">=</span><span class="s">&quot;driver_LHS&quot;</span><span class="p">)</span>
    <span class="n">driver_RHS</span> <span class="o">=</span><span class="n">mfc</span><span class="o">.</span><span class="n">NeuronPopulation</span><span class="p">(</span><span class="n">sim</span><span class="o">=</span><span class="n">sim</span><span class="p">,</span> <span class="n">neuron_functor</span><span class="o">=</span><span class="n">make_cell_dinr</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">nNeurons</span><span class="p">,</span> <span class="n">pop_name</span><span class="o">=</span><span class="s">&quot;driver_RHS&quot;</span><span class="p">)</span>
    
    
    <span class="c"># Connect the drivers:</span>
    <span class="n">mfc</span><span class="o">.</span><span class="n">Connectors</span><span class="o">.</span><span class="n">times_to_all</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">syncronous_times</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,)</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">postsynaptic_population</span><span class="o">=</span> <span class="n">driver_LHS</span><span class="p">,</span> <span class="n">connect_functor</span> <span class="o">=</span> <span class="n">onto_driver</span><span class="p">)</span>
    <span class="n">mfc</span><span class="o">.</span><span class="n">Connectors</span><span class="o">.</span><span class="n">times_to_all</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">syncronous_times</span><span class="o">=</span><span class="p">(</span><span class="mi">105</span><span class="p">,)</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">postsynaptic_population</span><span class="o">=</span> <span class="n">driver_RHS</span><span class="p">,</span> <span class="n">connect_functor</span> <span class="o">=</span> <span class="n">onto_driver</span><span class="p">)</span>
    <span class="c">#</span>
    <span class="c"># LHS</span>
    <span class="c">#######</span>
    <span class="c"># Connect the drivers to eveything:</span>
    <span class="n">mfc</span><span class="o">.</span><span class="n">Connectors</span><span class="o">.</span><span class="n">all_to_all</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic_population</span><span class="o">=</span><span class="n">driver_LHS</span><span class="p">,</span> <span class="n">postsynaptic_population</span><span class="o">=</span> <span class="n">cIN_LHS</span><span class="p">,</span> <span class="n">connect_functor</span> <span class="o">=</span> <span class="n">driver_onto_cin</span><span class="p">)</span>
    <span class="n">mfc</span><span class="o">.</span><span class="n">Connectors</span><span class="o">.</span><span class="n">all_to_all</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic_population</span><span class="o">=</span><span class="n">driver_LHS</span><span class="p">,</span> <span class="n">postsynaptic_population</span><span class="o">=</span> <span class="n">dINr_LHS</span><span class="p">,</span> <span class="n">connect_functor</span> <span class="o">=</span> <span class="n">driver_onto_dinr</span><span class="p">)</span>
    <span class="c"># Connect the dINrs to eveything:</span>
    <span class="n">mfc</span><span class="o">.</span><span class="n">Connectors</span><span class="o">.</span><span class="n">all_to_all</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic_population</span><span class="o">=</span><span class="n">dINr_LHS</span><span class="p">,</span> <span class="n">postsynaptic_population</span><span class="o">=</span> <span class="n">cIN_LHS</span><span class="p">,</span> <span class="n">connect_functor</span> <span class="o">=</span> <span class="n">dinr_onto_cin</span><span class="p">)</span>
    
    <span class="c"># Connect the cINs to eveything contra-laterally:</span>
    <span class="n">mfc</span><span class="o">.</span><span class="n">Connectors</span><span class="o">.</span><span class="n">all_to_all</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic_population</span><span class="o">=</span><span class="n">cIN_LHS</span><span class="p">,</span> <span class="n">postsynaptic_population</span><span class="o">=</span> <span class="n">cIN_RHS</span><span class="p">,</span> <span class="n">connect_functor</span> <span class="o">=</span> <span class="n">cin_onto_cin</span><span class="p">)</span>
    <span class="n">syn_cin_dinr_lr</span> <span class="o">=</span> <span class="n">mfc</span><span class="o">.</span><span class="n">Connectors</span><span class="o">.</span><span class="n">all_to_all</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic_population</span><span class="o">=</span><span class="n">cIN_LHS</span><span class="p">,</span> <span class="n">postsynaptic_population</span><span class="o">=</span> <span class="n">dINr_RHS</span><span class="p">,</span> <span class="n">connect_functor</span> <span class="o">=</span> <span class="n">cin_onto_dinr</span><span class="p">,</span> <span class="n">synapse_pop_name</span><span class="o">=</span><span class="s">&#39;syn_cin_dinr_lr&#39;</span><span class="p">)</span>
    
    
    <span class="c">## RHS</span>
    <span class="c">########</span>
    <span class="n">mfc</span><span class="o">.</span><span class="n">Connectors</span><span class="o">.</span><span class="n">all_to_all</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic_population</span><span class="o">=</span><span class="n">driver_RHS</span><span class="p">,</span> <span class="n">postsynaptic_population</span><span class="o">=</span> <span class="n">cIN_RHS</span><span class="p">,</span> <span class="n">connect_functor</span> <span class="o">=</span> <span class="n">driver_onto_cin</span><span class="p">)</span>
    <span class="n">mfc</span><span class="o">.</span><span class="n">Connectors</span><span class="o">.</span><span class="n">all_to_all</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic_population</span><span class="o">=</span><span class="n">driver_RHS</span><span class="p">,</span> <span class="n">postsynaptic_population</span><span class="o">=</span> <span class="n">dINr_RHS</span><span class="p">,</span> <span class="n">connect_functor</span> <span class="o">=</span> <span class="n">driver_onto_dinr</span><span class="p">)</span>
    <span class="c"># Connect the dINrs to eveything:</span>
    <span class="n">mfc</span><span class="o">.</span><span class="n">Connectors</span><span class="o">.</span><span class="n">all_to_all</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic_population</span><span class="o">=</span><span class="n">dINr_RHS</span><span class="p">,</span> <span class="n">postsynaptic_population</span><span class="o">=</span> <span class="n">cIN_RHS</span><span class="p">,</span> <span class="n">connect_functor</span> <span class="o">=</span> <span class="n">driver_onto_cin</span><span class="p">)</span>
    <span class="c">#mfc.Connectors.all_to_all(sim, presynaptic_population=dINr_RHS, postsynaptic_population= dINr_RHS, connect_functor = driver_onto_dinr)</span>
    
    <span class="c"># Connect the cINs to eveything contra-laterally:</span>
    <span class="n">mfc</span><span class="o">.</span><span class="n">Connectors</span><span class="o">.</span><span class="n">all_to_all</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic_population</span><span class="o">=</span><span class="n">cIN_RHS</span><span class="p">,</span> <span class="n">postsynaptic_population</span><span class="o">=</span> <span class="n">cIN_LHS</span><span class="p">,</span> <span class="n">connect_functor</span> <span class="o">=</span> <span class="n">cin_onto_cin</span><span class="p">)</span>
    <span class="c">#syn_cin_dinr_rl = mfc.Connectors.all_to_all(sim, presynaptic_population=cIN_RHS, postsynaptic_population= dINr_LHS, connect_functor = cin_onto_dinr, synapse_pop_name=&#39;syn_cin_dinr_lr&#39;)</span>
    
    
    
    
    <span class="n">driver_LHS</span><span class="o">.</span><span class="n">record_from_all</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">Cell</span><span class="o">.</span><span class="n">Recordables</span><span class="o">.</span><span class="n">MembraneVoltage</span><span class="p">)</span>
    <span class="n">driver_RHS</span><span class="o">.</span><span class="n">record_from_all</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">Cell</span><span class="o">.</span><span class="n">Recordables</span><span class="o">.</span><span class="n">MembraneVoltage</span><span class="p">)</span>
    <span class="n">dINr_LHS</span><span class="o">.</span><span class="n">record_from_all</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">Cell</span><span class="o">.</span><span class="n">Recordables</span><span class="o">.</span><span class="n">MembraneVoltage</span><span class="p">)</span>
    <span class="n">dINr_RHS</span><span class="o">.</span><span class="n">record_from_all</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">Cell</span><span class="o">.</span><span class="n">Recordables</span><span class="o">.</span><span class="n">MembraneVoltage</span><span class="p">)</span>
    <span class="n">cIN_LHS</span><span class="o">.</span><span class="n">record_from_all</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">Cell</span><span class="o">.</span><span class="n">Recordables</span><span class="o">.</span><span class="n">MembraneVoltage</span><span class="p">)</span>
    <span class="n">cIN_RHS</span><span class="o">.</span><span class="n">record_from_all</span><span class="p">(</span><span class="n">what</span><span class="o">=</span><span class="n">mf</span><span class="o">.</span><span class="n">Cell</span><span class="o">.</span><span class="n">Recordables</span><span class="o">.</span><span class="n">MembraneVoltage</span><span class="p">)</span>
    <span class="c">#aIN_LHS.record_from_all(what=mf.Cell.Recordables.MembraneVoltage)</span>
    <span class="c">#aIN_RHS.record_from_all(what=mf.Cell.Recordables.MembraneVoltage)</span>
    
    
    <span class="c">#syn_cin_dinr_lr.record_from_all(what=&#39;g&#39;)</span>
    
    
    
    <span class="n">mfc</span><span class="o">.</span><span class="n">Connectors</span><span class="o">.</span><span class="n">all_to_all</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic_population</span><span class="o">=</span><span class="n">cIN_RHS</span><span class="p">,</span> <span class="n">postsynaptic_population</span><span class="o">=</span> <span class="n">cIN_LHS</span><span class="p">,</span> <span class="n">connect_functor</span> <span class="o">=</span> <span class="n">expbuiltin</span><span class="p">)</span>
    <span class="n">mfc</span><span class="o">.</span><span class="n">Connectors</span><span class="o">.</span><span class="n">all_to_all</span><span class="p">(</span><span class="n">sim</span><span class="p">,</span> <span class="n">presynaptic_population</span><span class="o">=</span><span class="n">cIN_RHS</span><span class="p">,</span> <span class="n">postsynaptic_population</span><span class="o">=</span> <span class="n">cIN_LHS</span><span class="p">,</span> <span class="n">connect_functor</span> <span class="o">=</span> <span class="n">exp2builtin</span><span class="p">)</span>
    
    
    
    
    <span class="c">#mf.SimulationMRedoc.build(sim).to_pdf(&#39;~/Desktop/BartSim.pdf&#39;)</span>
    <span class="n">res</span> <span class="o">=</span><span class="n">sim</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">get_traces</span><span class="p">():</span>
        <span class="k">print</span> <span class="n">tr</span><span class="o">.</span><span class="n">tags</span>
    
    
    <span class="n">mf</span><span class="o">.</span><span class="n">TagViewer</span><span class="p">(</span><span class="n">res</span><span class="p">,</span>
            <span class="n">plots</span><span class="o">=</span><span class="p">[</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">TagPlot</span><span class="p">(</span><span class="s">&quot;ALL{Voltage}&quot;</span><span class="p">,</span> <span class="n">yrange</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">,</span> <span class="mi">50</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">)</span> <span class="p">),</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">TagPlot</span><span class="p">(</span><span class="s">&quot;ALL{Voltage,driver_LHS}&quot;</span><span class="p">,</span> <span class="n">yrange</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">,</span> <span class="mi">50</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">)</span> <span class="p">),</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">TagPlot</span><span class="p">(</span><span class="s">&quot;ALL{Voltage,dINR_LHS}&quot;</span><span class="p">,</span> <span class="n">yrange</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">,</span> <span class="mi">50</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">)</span> <span class="p">),</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">TagPlot</span><span class="p">(</span><span class="s">&quot;ALL{Voltage,cIN_LHS}&quot;</span><span class="p">,</span> <span class="n">yrange</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">,</span> <span class="mi">50</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">)</span> <span class="p">),</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">TagPlot</span><span class="p">(</span><span class="s">&quot;ALL{Voltage,aIN_LHS}&quot;</span><span class="p">,</span> <span class="n">yrange</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">,</span> <span class="mi">50</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">)</span> <span class="p">),</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">TagPlot</span><span class="p">(</span><span class="s">&quot;ALL{Voltage,driver_RHS}&quot;</span><span class="p">,</span> <span class="n">yrange</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">,</span> <span class="mi">50</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">)</span> <span class="p">),</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">TagPlot</span><span class="p">(</span><span class="s">&quot;ALL{Voltage,dINR_RHS}&quot;</span><span class="p">,</span> <span class="n">yrange</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">,</span> <span class="mi">50</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">)</span> <span class="p">),</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">TagPlot</span><span class="p">(</span><span class="s">&quot;ALL{Voltage,cIN_RHS}&quot;</span><span class="p">,</span> <span class="n">yrange</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">,</span> <span class="mi">50</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">)</span> <span class="p">),</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">TagPlot</span><span class="p">(</span><span class="s">&quot;ALL{Voltage,aIN_RHS}&quot;</span><span class="p">,</span> <span class="n">yrange</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">,</span> <span class="mi">50</span><span class="o">*</span><span class="n">mf</span><span class="o">.</span><span class="n">mV</span><span class="p">)</span> <span class="p">),</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">TagPlot</span><span class="p">(</span><span class="s">&#39;ALL{PREPOP:cIN_LHS,POSTPOP:dINR_RHS}&#39;</span><span class="p">),</span>
        <span class="n">mf</span><span class="o">.</span><span class="n">TagPlot</span><span class="p">(</span><span class="s">&#39;ALL{PREPOP:cIN_RHS,POSTPOP:dINR_LHS}&#39;</span><span class="p">),</span>
    
               <span class="p">])</span>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <span class="c"># What to run:</span>
    <span class="c">#test_step_current_injections()</span>
    
    <span class="n">pylab</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

      </div>
      <div class="bottomnav">
      
        <p>
        <a class="uplink" href="../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, Mike Hull.
    </div>
  </body>
</html>