

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>morphforgecontrib.simulation.channels.hh_style.summarisers.alphabeta &mdash; morphforge</title>
    
    <link rel="stylesheet" href="../../../../../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../../_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../../',
        VERSION:     '0.1-alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../../../../_static/theme_extras.js"></script>
    <link rel="top" title="morphforge" href="../../../../../../index.html" />
    <link rel="up" title="Module code" href="../../../../../index.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../../../../../../index.html">
          <span>morphforge</span></a></h1>
        <h2 class="heading"><span>morphforgecontrib.simulation.channels.hh_style.summarisers.alphabeta</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a class="uplink" href="../../../../../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for morphforgecontrib.simulation.channels.hh_style.summarisers.alphabeta</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">morphforge.stdimports</span> <span class="kn">as</span> <span class="nn">mf</span>

<span class="kn">from</span> <span class="nn">..core</span> <span class="kn">import</span> <span class="n">StdChlAlphaBeta</span>

<span class="kn">import</span> <span class="nn">mredoc</span> <span class="kn">as</span> <span class="nn">mrd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylab</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="kn">as</span> <span class="nn">mpl</span>


<span class="k">def</span> <span class="nf">set_fontsize</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">fontsize</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<div class="viewcode-block" id="set_fontsize"><a class="viewcode-back" href="../../../../../../apidoc/mfi-core/morphforgecontrib.simulation.channels.hh_style.summarisers.html#morphforgecontrib.simulation.channels.hh_style.summarisers.alphabeta.set_fontsize">[docs]</a><span class="sd">    For each text object of a figure fig, set the font size to fontsize</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">match</span><span class="p">(</span><span class="n">artist</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">artist</span><span class="o">.</span><span class="n">__module__</span> <span class="o">==</span> <span class="s">&quot;matplotlib.text&quot;</span>

    <span class="k">for</span> <span class="n">textobj</span> <span class="ow">in</span> <span class="n">fig</span><span class="o">.</span><span class="n">findobj</span><span class="p">(</span><span class="n">match</span><span class="o">=</span><span class="n">match</span><span class="p">):</span>
        <span class="n">textobj</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>




<span class="k">def</span> <span class="nf">plot_sv</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">sv_name</span><span class="p">,</span> <span class="n">sv_coeffs</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="n">plot_kwargs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">what</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">,</span><span class="s">&#39;beta&#39;</span><span class="p">,</span><span class="s">&#39;tau&#39;</span><span class="p">,</span><span class="s">&#39;inf&#39;</span><span class="p">]</span></div>
<div class="viewcode-block" id="plot_sv"><a class="viewcode-back" href="../../../../../../apidoc/mfi-core/morphforgecontrib.simulation.channels.hh_style.summarisers.html#morphforgecontrib.simulation.channels.hh_style.summarisers.alphabeta.plot_sv">[docs]</a>
    <span class="n">SV</span> <span class="o">=</span> <span class="n">sv_coeffs</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">SV</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">SV</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">SV</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="p">(</span><span class="n">SV</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span> <span class="p">)</span> <span class="o">/</span> <span class="n">SV</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="p">))</span>
    <span class="n">beta</span>  <span class="o">=</span> <span class="p">(</span><span class="n">SV</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">SV</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">SV</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="p">(</span><span class="n">SV</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span> <span class="p">)</span> <span class="o">/</span> <span class="n">SV</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="p">))</span>

    <span class="n">inf</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="p">)</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">+</span><span class="n">beta</span><span class="p">)</span>

    <span class="n">vals</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;alpha&#39;</span><span class="p">:</span><span class="n">alpha</span><span class="p">,</span>
            <span class="s">&#39;beta&#39;</span><span class="p">:</span><span class="n">beta</span><span class="p">,</span>
            <span class="s">&#39;inf&#39;</span><span class="p">:</span><span class="n">inf</span><span class="p">,</span>
            <span class="s">&#39;tau&#39;</span><span class="p">:</span><span class="n">tau</span><span class="p">,</span>
            <span class="p">}[</span><span class="n">what</span><span class="p">]</span>

    <span class="n">plot_kwargs</span> <span class="o">=</span> <span class="n">plot_kwargs</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">sv_name</span> <span class="p">,</span><span class="o">**</span><span class="n">plot_kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AlphaBetaSummariser</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span></div>
<div class="viewcode-block" id="AlphaBetaSummariser"><a class="viewcode-back" href="../../../../../../apidoc/mfi-core/morphforgecontrib.simulation.channels.hh_style.summarisers.html#morphforgecontrib.simulation.channels.hh_style.summarisers.alphabeta.AlphaBetaSummariser">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">pass</span>
<div class="viewcode-block" id="AlphaBetaSummariser.build"><a class="viewcode-back" href="../../../../../../apidoc/mfi-core/morphforgecontrib.simulation.channels.hh_style.summarisers.html#morphforgecontrib.simulation.channels.hh_style.summarisers.alphabeta.AlphaBetaSummariser.build">[docs]</a>        <span class="n">param_tbl</span><span class="o">=</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span> <span class="p">[</span><span class="s">&#39;Parameter&#39;</span><span class="p">,</span><span class="s">&#39;Value&#39;</span><span class="p">],</span>
                <span class="p">[</span>
                    <span class="p">(</span><span class="s">&#39;Conductance (gmax)&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">conductance</span><span class="o">.</span><span class="n">rescale</span><span class="p">(</span><span class="s">&#39;mS/cm2&#39;</span><span class="p">))</span> <span class="p">),</span>
                    <span class="p">(</span><span class="s">&#39;Reversal Potential&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">reversalpotential</span><span class="o">.</span><span class="n">rescale</span><span class="p">(</span><span class="s">&#39;mV&#39;</span><span class="p">))),</span>
                 <span class="p">]</span> <span class="p">)</span>


        <span class="n">sv_eqns</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sv_tbls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sv</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">statevars</span><span class="p">:</span>
            <span class="n">sv_table</span> <span class="o">=</span> <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span> <span class="p">[</span><span class="s">&#39;$</span><span class="si">%s</span><span class="s">$&#39;</span><span class="o">%</span><span class="n">sv</span><span class="p">,</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="s">&#39;B&#39;</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">,</span><span class="s">&#39;D&#39;</span><span class="p">,</span><span class="s">&#39;E&#39;</span><span class="p">],</span>
                   <span class="p">(</span>  <span class="p">[</span><span class="s">&#39;Alpha&#39;</span><span class="p">]</span> <span class="o">+</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span>  <span class="n">obj</span><span class="o">.</span><span class="n">statevars</span><span class="p">[</span><span class="n">sv</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                      <span class="p">[</span><span class="s">&#39;Beta&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span>  <span class="n">obj</span><span class="o">.</span><span class="n">statevars</span><span class="p">[</span><span class="n">sv</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span>
                       <span class="p">)</span> <span class="p">)</span>
            <span class="n">sv_tbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sv_table</span><span class="p">)</span>

            <span class="n">sv_eqns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">r&quot;&quot;&quot;\frac{d}{dt}</span><span class="si">%s</span><span class="s"> &amp;= \frac{</span><span class="si">%s</span><span class="s">_\infty(V) - </span><span class="si">%s</span><span class="s">}{\tau_{</span><span class="si">%s</span><span class="s">}(V)}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span><span class="n">sv</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">sv_eqns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">r&quot;&quot;&quot;</span><span class="si">%s</span><span class="s">_\infty(V) &amp;= \frac{\alpha_{</span><span class="si">%s</span><span class="s">}(V)}{\alpha_{</span><span class="si">%s</span><span class="s">}(V) + \beta_{</span><span class="si">%s</span><span class="s">}(V)}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span><span class="n">sv</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">sv_eqns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">r&quot;&quot;&quot;\tau_{</span><span class="si">%s</span><span class="s">}(V) &amp;= \frac{1.0}{\alpha_{</span><span class="si">%s</span><span class="s">}(V) + \beta_{</span><span class="si">%s</span><span class="s">}(V)}&quot;&quot;&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span><span class="n">sv</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">sv_eqns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">r&quot;&quot;&quot;\alpha_{</span><span class="si">%s</span><span class="s">}(V),\beta_{</span><span class="si">%s</span><span class="s">}(V)  &amp;= \frac{A + BV}{C + exp(\dfrac{D+V}{E})} &quot;&quot;&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span><span class="n">sv</span><span class="p">)</span> <span class="p">)</span>


        <span class="n">sv_fig</span> <span class="o">=</span> <span class="n">pylab</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">sv_fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="s">&#39;beta&#39;</span><span class="p">:</span>  <span class="n">sv_fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
        <span class="s">&#39;inf&#39;</span><span class="p">:</span>   <span class="n">sv_fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="s">&#39;tau&#39;</span><span class="p">:</span>   <span class="n">sv_fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">sv_name</span><span class="p">,</span> <span class="n">sv_vars</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">statevars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">plot_sv</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s">&#39;alpha&#39;</span><span class="p">],</span> <span class="n">sv_name</span><span class="p">,</span> <span class="n">sv_vars</span><span class="p">,</span> <span class="s">&#39;alpha&#39;</span><span class="p">)</span>
            <span class="n">plot_sv</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s">&#39;beta&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="n">sv_name</span><span class="p">,</span> <span class="n">sv_vars</span><span class="p">,</span> <span class="s">&#39;beta&#39;</span><span class="p">)</span>
            <span class="n">plot_sv</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s">&#39;inf&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="n">sv_name</span><span class="p">,</span> <span class="n">sv_vars</span><span class="p">,</span> <span class="s">&#39;inf&#39;</span><span class="p">)</span>
            <span class="n">plot_sv</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="s">&#39;tau&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="n">sv_name</span><span class="p">,</span> <span class="n">sv_vars</span><span class="p">,</span> <span class="s">&#39;tau&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">ax_name</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ax_name</span><span class="p">)</span>

        <span class="n">set_fontsize</span><span class="p">(</span><span class="n">sv_fig</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="n">img_caption</span> <span class="o">=</span> <span class="s">&#39;The rate constants and resulting steady-state activation and time constants for </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">obj</span><span class="o">.</span><span class="n">statevars</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Summary of </span><span class="si">%s</span><span class="s"> (StdChlAlphaBeta)&#39;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">mrd</span><span class="o">.</span><span class="n">EquationBlock</span><span class="p">(</span>
                    <span class="n">mrd</span><span class="o">.</span><span class="n">Equation</span><span class="p">(</span> <span class="s">&#39;g &amp;= gmax * </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">eqn</span><span class="p">),</span>
                    <span class="n">mrd</span><span class="o">.</span><span class="n">Equation</span><span class="p">(</span> <span class="s">&#39;i &amp;= g * (erev-V)&#39;</span> <span class="p">),</span>
                    <span class="p">),</span>
                <span class="n">mrd</span><span class="o">.</span><span class="n">EquationBlock</span><span class="p">(</span>
                    <span class="o">*</span><span class="n">sv_eqns</span>
                    <span class="p">),</span>
                <span class="n">param_tbl</span><span class="p">,</span>
                <span class="n">sv_tbls</span><span class="p">,</span>
                <span class="n">mrd</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">sv_fig</span><span class="p">,</span> <span class="n">auto_adjust</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> <span class="n">caption</span><span class="o">=</span><span class="n">img_caption</span>  <span class="p">),</span>


                <span class="p">)</span>


<span class="c">#assert False</span>
<span class="n">mf</span><span class="o">.</span><span class="n">SummariserLibrary</span><span class="o">.</span><span class="n">register_summariser</span><span class="p">(</span> <span class="n">StdChlAlphaBeta</span><span class="p">,</span> <span class="n">AlphaBetaSummariser</span><span class="p">)</span>
</pre></div></div></div>

      </div>
      <div class="bottomnav">
      
        <p>
        <a class="uplink" href="../../../../../../index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, Mike Hull.
    </div>
  </body>
</html>