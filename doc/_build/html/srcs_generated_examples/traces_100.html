

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>25. &lt;Missing Docstring&gt; &mdash; morphforge</title>
    
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1-alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/theme_extras.js"></script>
    <link rel="top" title="morphforge" href="../index.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../index.html">
          <span>morphforge</span></a></h1>
        <h2 class="heading"><span>25. &lt;Missing Docstring&gt;</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="missing-docstring">
<h1>25. &lt;Missing Docstring&gt;</h1>
<div class="section" id="code">
<h2>Code</h2>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">morphforge.stdimports</span> <span class="kn">as</span> <span class="nn">mf</span>
<span class="kn">from</span>  <span class="nn">morphforge.traces.generation</span>  <span class="kn">import</span> <span class="n">TraceStringParser</span>
<span class="kn">from</span> <span class="nn">morphforge</span> <span class="kn">import</span> <span class="n">units</span>


<span class="kn">import</span> <span class="nn">mredoc</span> <span class="kn">as</span> <span class="nn">mrd</span>

<span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
<span class="c">#&quot;&quot;&quot;{d:pA} AT 0ms FLAT(1) FOR 100ms THEN RAMPTO(50) UNTIL 120ms THEN FLAT(50) FOR 20ms &quot;&quot;&quot;,</span>
<span class="c">#&quot;&quot;&quot;{d:pA} AT 0ms FLAT(0) UNTIL 150ms THEN FLAT(120) FOR 20ms THEN FLAT(0) FOR 20ms&quot;&quot;&quot;,</span>
<span class="c">#&quot;&quot;&quot;{d:pA} FLAT(1) FOR 100ms THEN RAMPTO(50) UNTIL 160ms&quot;&quot;&quot;,</span>
<span class="sd">&quot;&quot;&quot;{d:pA} FLAT(1) FOR 100ms THEN RAMPTO(50) UNTIL 130ms THEN FLAT(0) THEN AT 150ms FLAT(120) FOR 20ms THEN  FLAT(0) UNTIL 180ms&quot;&quot;&quot;</span><span class="p">,</span>
<span class="c">#&quot;&quot;&quot;{d:pA} FLAT(0) THEN AT 150ms FLAT(120) FOR 20ms THEN  FLAT(0) UNTIL 180ms&quot;&quot;&quot;,</span>
 <span class="p">]</span>



<span class="kn">from</span> <span class="nn">mhlibs.quantities_plot</span> <span class="kn">import</span> <span class="n">QuantitiesFigure</span>



<span class="n">returning_quantities</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s">&#39;mean&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="n">tr</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span>
    <span class="p">(</span><span class="s">&#39;min&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="n">tr</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span>
    <span class="p">(</span><span class="s">&#39;max&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="n">tr</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="p">]</span>

<span class="n">conversions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">TraceFixedDT</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="n">tr</span><span class="o">.</span><span class="n">convert_to_fixed</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span> <span class="p">),</span>
    <span class="c">#(mf.TraceVariableDT, lambda tr: tr.convert_to_variable(eps=0.1) ),</span>
    <span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">TracePiecewise</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="n">tr</span><span class="o">.</span><span class="n">convert_to_piecewise</span><span class="p">()</span> <span class="p">),</span>
        <span class="p">]</span>


<span class="n">returning_trace_methods</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">&#39;filterbessel&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="n">tr</span><span class="o">.</span><span class="n">filterbessel</span><span class="p">(</span><span class="n">filterorder</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">cutoff_frequency</span><span class="o">=</span><span class="mi">1000</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">Hz</span><span class="p">)</span> <span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;filterbutterworth&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="n">tr</span><span class="o">.</span><span class="n">filterbutterworth</span><span class="p">(</span><span class="n">filterorder</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">cutoff_frequency</span><span class="o">=</span><span class="mi">1000</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">Hz</span><span class="p">)</span> <span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;filterlowpassrc&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="n">tr</span><span class="o">.</span><span class="n">filterlowpassrc</span><span class="p">(</span><span class="n">tau</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span> <span class="p">),</span>

        <span class="p">(</span><span class="s">&#39;shift&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="n">tr</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">ms</span><span class="p">)),</span>
        <span class="p">(</span><span class="s">&#39;window&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="n">tr</span><span class="o">.</span><span class="n">window</span><span class="p">((</span><span class="mi">75</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="mi">160</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">ms</span><span class="p">))</span> <span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;windowshift&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="n">tr</span><span class="o">.</span><span class="n">windowshift</span><span class="p">((</span><span class="mi">75</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="mi">160</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">ms</span><span class="p">))</span> <span class="p">),</span>

        <span class="p">(</span><span class="s">&#39;convert_to_fixed&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="n">tr</span><span class="o">.</span><span class="n">convert_to_fixed</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">0.1</span><span class="o">*</span><span class="n">units</span><span class="o">.</span><span class="n">ms</span><span class="p">)</span> <span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;convert_to_piecewise&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">tr</span><span class="p">:</span> <span class="n">tr</span><span class="o">.</span><span class="n">convert_to_piecewise</span><span class="p">()</span> <span class="p">),</span>
        <span class="p">]</span>






<span class="n">tr</span> <span class="o">=</span> <span class="n">TraceStringParser</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">tests</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span> <span class="n">tr</span><span class="o">.</span><span class="n">get_min_time</span><span class="p">()</span>
<span class="k">print</span> <span class="n">tr</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">get_min_time</span><span class="p">()</span>

<span class="c">#sys.exit(0)</span>



<span class="k">def</span> <span class="nf">test_trace_method_traceout</span><span class="p">(</span><span class="n">src_trace</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">method_functor</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">QuantitiesFigure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">&#39;Testing Method: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">method_name</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">plotTrace</span><span class="p">(</span><span class="n">src_trace</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Original&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">conv_type</span><span class="p">,</span> <span class="n">conv_functor</span><span class="p">)</span> <span class="ow">in</span> <span class="n">conversions</span><span class="p">:</span>
        <span class="n">tr_new</span> <span class="o">=</span> <span class="n">conv_functor</span><span class="p">(</span><span class="n">src_trace</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mf</span><span class="o">.</span><span class="n">TraceMethodCtrl</span><span class="o">.</span><span class="n">has_method</span><span class="p">(</span><span class="n">conv_type</span><span class="p">,</span> <span class="n">method_name</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plotTrace</span><span class="p">(</span><span class="n">method_functor</span><span class="p">(</span><span class="n">tr_new</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">conv_type</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)</span> <span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span>
            <span class="s">&#39;Test: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">method_name</span><span class="p">,</span>
            <span class="n">mrd</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">auto_adjust</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="p">)</span>


<span class="k">def</span> <span class="nf">test_trace_method_scalarout</span><span class="p">(</span><span class="n">src_trace</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">method_functor</span><span class="p">):</span>

    <span class="n">res</span> <span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">conv_type</span><span class="p">,</span> <span class="n">conv_functor</span><span class="p">)</span> <span class="ow">in</span> <span class="n">conversions</span><span class="p">:</span>
        <span class="n">tr_new</span> <span class="o">=</span> <span class="n">conv_functor</span><span class="p">(</span><span class="n">src_trace</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">mf</span><span class="o">.</span><span class="n">TraceMethodCtrl</span><span class="o">.</span><span class="n">has_method</span><span class="p">(</span><span class="n">conv_type</span><span class="p">,</span> <span class="n">method_name</span><span class="p">):</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">conv_type</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="s">&#39;--&#39;</span><span class="p">])</span>
            <span class="k">continue</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">res_new</span> <span class="o">=</span> <span class="n">method_functor</span><span class="p">(</span><span class="n">tr_new</span><span class="p">)</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">conv_type</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">res_new</span><span class="p">)])</span>
        <span class="c">#ax2.plotTrace(method_functor(tr_new), label=&#39;%s:%s&#39; % (conv_type.__name__, method_name) )</span>


    <span class="k">print</span> <span class="n">res</span>
    <span class="p">(</span><span class="n">header</span><span class="p">,</span><span class="n">data</span><span class="p">)</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">res</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;header&#39;</span><span class="p">,</span> <span class="n">header</span>
    <span class="k">print</span> <span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="n">data</span>
    <span class="k">return</span> <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Tesing Method: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">method_name</span><span class="p">,</span>
            <span class="n">mrd</span><span class="o">.</span><span class="n">VerticalColTable</span><span class="p">(</span><span class="n">header</span><span class="p">,[</span><span class="n">data</span><span class="p">])</span>
            <span class="p">)</span>


<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>

    <span class="n">tr</span> <span class="o">=</span> <span class="n">TraceStringParser</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>


    <span class="n">sects</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="n">method_functor</span><span class="p">)</span> <span class="ow">in</span> <span class="n">returning_trace_methods</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">test_trace_method_traceout</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">method_functor</span><span class="p">)</span>
        <span class="n">sects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="c">#returning_quantities = [</span>
    <span class="c">#(&#39;mean&#39;, lambda tr: tr.mean()),</span>




    <span class="k">for</span> <span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="n">method_functor</span><span class="p">)</span> <span class="ow">in</span> <span class="n">returning_quantities</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">test_trace_method_scalarout</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">method_functor</span><span class="p">)</span>
        <span class="n">sects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>


    <span class="n">mrd</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="s">&#39;Testing: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">t</span><span class="p">,</span> <span class="n">sects</span><span class="p">)</span><span class="o">.</span><span class="n">to_pdf</span><span class="p">(</span><span class="s">&#39;~/Desktop/trace_testing.pdf&#39;</span><span class="p">)</span>







<span class="c">#import pylab</span>
<span class="c">#pylab.show()</span>
</pre></div>
</div>
</div>
<div class="section" id="output">
<h2>Output</h2>
<div class="highlight-bash"><div class="highlight"><pre>
</pre></div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, Mike Hull.
    </div>
  </body>
</html>